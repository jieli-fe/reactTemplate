function getplaybackOptions(){return{marker:function(e){var t=e.dataType;return"ship"==t?{icon:Playback_markericon_ship}:"typhoon"==t?{icon:Playback_markericon_typhoon}:void 0}}}!function(e){var t;if("function"==typeof define&&define.amd)define(["leaflet"],e);else if("object"==typeof module&&"object"==typeof module.exports)t=require("leaflet"),module.exports=e(t);else{if(void 0===window.L)throw"Leaflet must be loaded first";e(window.L)}}(function(e){return e.Playback=e.Playback||{},e.Playback.Util=e.Class.extend({statics:{DateStr:function(e){return new Date(e).toDateString()},TimeStr:function(e){var t=new Date(e),o=t.getHours(),n=t.getMinutes(),a=t.getSeconds(),i=e/1e3,l=(i-Math.floor(i)).toFixed(2).slice(1),d="AM";return o>11&&(o%=12,d="PM"),0===o&&(o=12),n<10&&(n="0"+n),a<10&&(a="0"+a),o+":"+n+":"+a+l+" "+d},ParseGPX:function(e){for(var t={type:"Feature",geometry:{type:"MultiPoint",coordinates:[]},properties:{time:[],speed:[],altitude:[]},bbox:[]},o=$.parseXML(e),n=$(o).find("trkpt"),a=0,i=n.length;a<i;a++){var l=n[a],d=parseFloat(l.getAttribute("lat")),c=parseFloat(l.getAttribute("lon")),r=$(l).find("time").text(),p=$(l).find("ele").text(),s=new Date(r).getTime(),u=parseFloat(p),_=t.geometry.coordinates,h=t.properties.time,y=t.properties.altitude;_.push([c,d]),h.push(s),y.push(u)}return t}}}),e.Playback=e.Playback||{},e.Playback.MoveableMarker=e.Marker.extend({initialize:function(t,o,n){var a=o.marker||{};jQuery.isFunction(a)&&(a=a(n)),e.Marker.prototype.initialize.call(this,t,a),this.popupContent="",this.feature=n,a.getPopup&&(this.popupContent=a.getPopup(n)),o.popups&&this.bindPopup(this.getPopupContent()+t.toString()),o.labels&&(this.bindLabel?this.bindLabel(this.getPopupContent()):console.log("Label binding requires leaflet-label (https://github.com/Leaflet/Leaflet.label)"))},getPopupContent:function(){return""!==this.popupContent?"<b>"+this.popupContent+"</b><br/>":""},move:function(t,o){if(e.DomUtil.TRANSITION&&(this._icon&&(this._icon.style[e.DomUtil.TRANSITION]="all "+o+"ms linear",this._popup&&this._popup._wrapper&&(this._popup._wrapper.style[e.DomUtil.TRANSITION]="all "+o+"ms linear")),this._shadow&&(this._shadow.style[e.DomUtil.TRANSITION]="all "+o+"ms linear")),this.setLatLng(t),this._popup){var n=$.cookie("userLanguage"),a="当前位置";if(n&&"en"==n&&(a="Postion "),"ship"==this.feature.dataType){"0";l="";l=(i=this._latlng.lng.toFixed(2))<0?this.duToGpsDM(i,"W"):this.duToGpsDM(i,"E");c="";c=(d=this._latlng.lat.toFixed(2))<0?this.duToGpsDM(i,"S"):this.duToGpsDM(i,"N"),this._popup.setContent(this.getPopupContent()+a+l+","+c)}else{var i=this._latlng.lng.toFixed(2),l="";l=i<0?this.duToGpsDM(i,"W"):this.duToGpsDM(i,"E");var d=this._latlng.lat.toFixed(2),c="";c=d<0?this.duToGpsDM(i,"S"):this.duToGpsDM(i,"N"),this._popup.setContent(this.getPopupContent()+a+"（"+l+","+c+"）")}}},duToGpsDM:function(e,t){for(var o,n=(e=e.toString().replace(/\s+/g,"")).length,a="",i=new Array,l=0,d=0,c=0;c<=n;c++)e[c]>="0"&&e[c]<="9"?(d=1,a+=e[c]):"."==e[c]?(i[l]=a,a="",i[++l]=".",d=1,l++):a.length>0&&(i[l]=a,a="",l++);return 1==d&&(o=+i[0]+"°"+(60*parseFloat("0"+i[1]+i[2],10)).toFixed(2)+"′ "+t),o},_old__setPos:e.Marker.prototype._setPos,_updateImg:function(t,o,n){o=e.point(n).divideBy(2)._subtract(e.point(o));var a="";a+=" translate("+this._ImageOffset(this.options.iconAngle,n[0],"x")+"px, "+this._ImageOffset(this.options.iconAngle,n[1],"y")+"px)",a+=" rotate("+this.options.iconAngle+"deg)",a+=" translate("+o.x+"px, "+o.y+"px)",t.style[e.DomUtil.TRANSFORM]+=a},_ImageOffset:function(e,t,o){if(backvalue=0,null!=o&&"x"==o)e<=90?backvalue=t*Math.sin(e/180*Math.PI):e<=180?backvalue=t:e<=270&&(backvalue=t*Math.abs(Math.cos(e/180*Math.PI))),e>7&&e<=10?backvalue-=1:e>10&&e<=30?backvalue-=5:e>30&&e<=40?backvalue-=7:e>40&&e<=45?backvalue-=9:e>45&&e<=50?backvalue-=2:e>50&&e<=75?backvalue-=3:e>140&&e<=160?backvalue+=8:e>190&&e<=195?backvalue-=1:e>195&&e<=205?backvalue+=4:e>205&&e<=215?backvalue-=1:e>215&&e<=255&&(backvalue+=4);else if(null!=o&&"y"==o){var n=Math.floor(e%45);e<=90?backvalue=-t*(1-Math.sin((n+45)/180*Math.PI)):e<=180?(offsetbackvalue=t*(Math.sqrt(2)*Math.sin((n+45)/180*Math.PI)-1),backvalue=t*Math.abs(Math.cos(e/180*Math.PI)),backvalue-=offsetbackvalue):e<=270?backvalue=t:e<=360&&(backvalue=t*Math.abs(Math.sin(e/180*Math.PI))),e>10&&e<=30?backvalue-=3:e>30&&e<=50?backvalue-=5:e>50&&e<=75?backvalue-=3:e>75&&e<=89?backvalue-=3:e>93&&e<=107?backvalue+=1:e>110&&e<=120?backvalue+=2:e>=220&&e<=230?backvalue-=2:e>230&&e<=234?backvalue-=2:e>234&&e<=240?backvalue-=2:e>240&&e<=245?backvalue-=1:e>250&&e<=260?backvalue+=2:e>279&&e<=305&&(backvalue-=2)}return backvalue},setIconAngle:function(e){this.options.iconAngle=e,this._map&&this.update()},_setPos:function(t){if(this._icon&&(this._icon.style[e.DomUtil.TRANSFORM]=""),this._shadow&&(this._shadow.style[e.DomUtil.TRANSFORM]=""),this._old__setPos.apply(this,[t]),this.options.iconAngle){var o,n=this.options.icon.options.iconAnchor,a=this.options.icon.options.iconSize;this._icon&&(o=this._icon,this._updateImg(o,n,a)),this._shadow&&(a=this.options.icon.options.shadowSize,o=this._shadow,this._updateImg(o,n,a))}}}),e.Playback=e.Playback||{},e.Playback.Track=e.Class.extend({initialize:function(e,t){var o=(t=t||{}).tickLen||250;this._staleTime=t.staleTime||36e5,this._fadeMarkersWhenStale=t.fadeMarkersWhenStale||!1,this._geoJSON=e,this._tickLen=o,this._ticks=[],this._marker=null,this._orientations=[];var n=e.properties.time;this._orientIcon=t.orientIcons;var a,i,l,d=e.geometry.coordinates,c=d[0],r=d[1],p=n[0],s=p,u=n[1],_=s%o;if(1===n.length)return 0!==_&&(s+=o-_),this._ticks[s]=d[0],this._orientations[s]=0,this._startTime=s,void(this._endTime=s);for(0!==_?(l=(i=o-_)/(u-p),s+=i,this._ticks[s]=this._interpolatePoint(c,r,l),this._orientations[s]=this._directionOfPoint(c,r),a=this._orientations[s]):(this._ticks[s]=c,this._orientations[s]=this._directionOfPoint(c,r),a=this._orientations[s]),this._startTime=s,s+=o;s<u;)l=(s-p)/(u-p),this._ticks[s]=this._interpolatePoint(c,r,l),this._orientations[s]=this._directionOfPoint(c,r),a=this._orientations[s],s+=o;for(var h=1,y=d.length;h<y;h++)for(c=d[h],r=d[h+1],s=p=n[h],u=n[h+1],0!==(_=s%o)&&u?(l=(i=o-_)/(u-p),s+=i,this._ticks[s]=this._interpolatePoint(c,r,l),r?(this._orientations[s]=this._directionOfPoint(c,r),a=this._orientations[s]):this._orientations[s]=a):(this._ticks[s]=c,r?(this._orientations[s]=this._directionOfPoint(c,r),a=this._orientations[s]):this._orientations[s]=a),s+=o;s<u;){var f=p,g=c;l=(s-p)/(u-p),u-p>t.maxInterpolationTime?(this._ticks[s]=c,r?(this._orientations[s]=this._directionOfPoint(c,r),a=this._orientations[s]):this._orientations[s]=a):(l=(s-f)/(u-f),this._ticks[s]=this._interpolatePoint(g,r,l),r?(this._orientations[s]=this._directionOfPoint(g,r),a=this._orientations[s]):this._orientations[s]=a),f=s,g=this._ticks[s],s+=o}this._endTime=s-o,this._lastTick=this._ticks[this._endTime]},_interpolatePoint:function(e,t,o){try{var n=[t[0]-e[0],t[1]-e[1]],a=[n[0]*o,n[1]*o];return[e[0]+a[0],e[1]+a[1]]}catch(n){console.log("err: cant interpolate a point"),console.log(["start",e]),console.log(["end",t]),console.log(["ratio",o])}},_directionOfPoint:function(e,t){return this._getBearing(e[1],e[0],t[1],t[0])},_getBearing:function(e,t,o,n){e=this._radians(e),t=this._radians(t),o=this._radians(o);var a=(n=this._radians(n))-t,i=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(e/2+Math.PI/4));return Math.abs(a)>Math.PI&&(a=a>0?-(2*Math.PI-a):2*Math.PI+a),(this._degrees(Math.atan2(a,i))+360)%360},_radians:function(e){return e*(Math.PI/180)},_degrees:function(e){return e*(180/Math.PI)},getFirstTick:function(){return this._ticks[this._startTime]},getLastTick:function(){return this._ticks[this._endTime]},getStartTime:function(){return this._startTime},getEndTime:function(){return this._endTime},getTickMultiPoint:function(){for(var e=this.getStartTime(),t=this.getEndTime(),o=[],n=[];e<=t;)n.push(e),o.push(this.tick(e)),e+=this._tickLen;return{type:"Feature",geometry:{type:"MultiPoint",coordinates:o},properties:{time:n}}},trackPresentAtTick:function(e){return e>=this._startTime},trackStaleAtTick:function(e){return this._endTime+this._staleTime<=e},tick:function(e){return e>this._endTime&&(e=this._endTime),e<this._startTime&&(e=this._startTime),this._ticks[e]},courseAtTime:function(e){return e>this._endTime&&(e=this._endTime),e<this._startTime&&(e=this._startTime),this._orientations[e]},setMarker:function(t,o){var n=null;if(n=t?this.tick(t):this.getFirstTick()){var a=new e.LatLng(n[1],n[0]);this._marker=new e.Playback.MoveableMarker(a,o,this._geoJSON),o.mouseOverCallback&&this._marker.on("mouseover",o.mouseOverCallback),o.clickCallback&&this._marker.on("click",o.clickCallback),this._fadeMarkersWhenStale&&!this.trackPresentAtTick(t)&&this._marker.setOpacity(0)}return this._marker},moveMarker:function(e,t,o){if(this._marker){this._fadeMarkersWhenStale&&(this.trackPresentAtTick(o)?this._marker.setOpacity(1):this._marker.setOpacity(0),this.trackStaleAtTick(o)&&this._marker.setOpacity(.25));var n=this._geoJSON.dataType;(this._orientIcon||"ship"==n)&&this._marker.setIconAngle(this.courseAtTime(o)),this._marker.move(e,t)}},getMarker:function(){return this._marker}}),e.Playback=e.Playback||{},e.Playback.TrackController=e.Class.extend({initialize:function(e,t,o){this.options=o||{},this._map=e,this._tracks=[],this.setTracks(t)},clearTracks:function(){for(;this._tracks.length>0;){var e=this._tracks.pop().getMarker();e&&this._map.removeLayer(e)}},setTracks:function(e){this.clearTracks(),this.addTracks(e)},addTracks:function(e){if(e)if(e instanceof Array)for(var t=0,o=e.length;t<o;t++)this.addTrack(e[t]);else this.addTrack(e)},addTrack:function(e,t){if(e){var o=e.setMarker(t,this.options);o&&(o.addTo(this._map),this._tracks.push(e))}},tock:function(t,o){for(var n=0,a=this._tracks.length;n<a;n++){var i=this._tracks[n].tick(t),l=new e.LatLng(i[1],i[0]);this._tracks[n].moveMarker(l,o,t),null!=this.options.TrackCallback&&this.options.TrackCallback(n,t,l.lat,l.lng)}},addTrackCallback:function(e){this.options.TrackCallback=e},getStartTime:function(){var e=0;if(this._tracks.length>0){e=this._tracks[0].getStartTime();for(var t=1,o=this._tracks.length;t<o;t++){var n=this._tracks[t].getStartTime();n<e&&(e=n)}}return e},getEndTime:function(){var e=0;if(this._tracks.length>0){e=this._tracks[0].getEndTime();for(var t=1,o=this._tracks.length;t<o;t++){var n=this._tracks[t].getEndTime();n>e&&(e=n)}}return e},getTracks:function(){return this._tracks}}),e.Playback=e.Playback||{},e.Playback.Clock=e.Class.extend({initialize:function(t,o,n){this._trackController=t,this._callbacksArry=[],o&&this.addCallback(o),e.setOptions(this,n),this._speed=this.options.speed,this._tickLen=this.options.tickLen,this._cursor=t.getStartTime(),this._transitionTime=this._tickLen/this._speed,this._trickzoom=1},_tick:function(e){e._cursor>e._trackController.getEndTime()?clearInterval(e._intervalID):(e._trackController.tock(e._cursor,e._transitionTime),e._callbacks(e._cursor),e._cursor+=e._tickLen*e._trickzoom)},_callbacks:function(e){for(var t=this._callbacksArry,o=0,n=t.length;o<n;o++)t[o](e)},addCallback:function(e){this._callbacksArry.push(e)},start:function(){this._intervalID||(this._intervalID=window.setInterval(this._tick,this._transitionTime,this))},stop:function(){this._intervalID&&(clearInterval(this._intervalID),this._intervalID=null)},getSpeed:function(){return this._speed},isPlaying:function(){return!!this._intervalID},setSpeed:function(e){this._speed=e,this._transitionTime=this._tickLen/e,this._intervalID&&(this.stop(),this.start())},setPlayTrickZoom:function(e){this._trickzoom=e},setCursor:function(e){var t=parseInt(e);if(t){var o=t%this._tickLen;0!==o&&(t+=this._tickLen-o),this._cursor=t,this._trackController.tock(this._cursor,0),this._callbacks(this._cursor)}},getTime:function(){return this._cursor},getStartTime:function(){return this._trackController.getStartTime()},getEndTime:function(){return this._trackController.getEndTime()},getTickLen:function(){return this._tickLen}}),e.Playback=e.Playback||{},e.Playback.TracksLayer=e.Class.extend({initialize:function(t,o){var n=o.layer||{};jQuery.isFunction(n)&&(n=n(feature)),n.pointToLayer||(n.pointToLayer=function(t,o){return new e.CircleMarker(o,{radius:5})}),this.layer=new e.GeoJSON(null,n);var a={"GPS Tracks":this.layer};e.control.layers(null,a,{collapsed:!1}).addTo(t)},clearLayer:function(){for(var e in this.layer._layers)this.layer.removeLayer(this.layer._layers[e])},addLayer:function(e){this.layer.addData(e)}}),e.Playback=e.Playback||{},e.Playback.DateControl=e.Control.extend({options:{position:"bottomleft",dateFormatFn:e.Playback.Util.DateStr,timeFormatFn:e.Playback.Util.TimeStr},initialize:function(t,o){e.setOptions(this,o),this.playback=t},onAdd:function(t){this._container=e.DomUtil.create("div","leaflet-control-layers leaflet-control-layers-expanded");var o=this,n=this.playback,a=n.getTime(),i=e.DomUtil.create("div","datetimeControl",this._container);return this._date=e.DomUtil.create("p","",i),this._time=e.DomUtil.create("p","",i),this._date.innerHTML=this.options.dateFormatFn(a),this._time.innerHTML=this.options.timeFormatFn(a),n.addCallback(function(e){o._date.innerHTML=o.options.dateFormatFn(e),o._time.innerHTML=o.options.timeFormatFn(e)}),this._container}}),e.Playback.PlayControl=e.Control.extend({options:{position:"bottomright"},initialize:function(e){this.playback=e},onAdd:function(t){this._container=e.DomUtil.create("div","leaflet-control-layers leaflet-control-layers-expanded");var o=this,n=this.playback;n.setSpeed(100);var a=e.DomUtil.create("div","playControl",this._container);this._button=e.DomUtil.create("button","",a),this._button.innerHTML="Play";var i=e.DomEvent.stopPropagation;return e.DomEvent.on(this._button,"click",i).on(this._button,"mousedown",i).on(this._button,"dblclick",i).on(this._button,"click",e.DomEvent.preventDefault).on(this._button,"click",function(){n.isPlaying()?(n.stop(),o._button.innerHTML="Play"):(n.start(),o._button.innerHTML="Stop")},this),this._container}}),e.Playback.SliderControl=e.Control.extend({options:{position:"bottomleft"},initialize:function(e){this.playback=e},onAdd:function(t){function o(e){var t=Number(e.target.value);a.setCursor(t)}this._container=e.DomUtil.create("div","leaflet-control-layers leaflet-control-layers-expanded");var n=this,a=this.playback;this._slider=e.DomUtil.create("input","slider",this._container),this._slider.type="range",this._slider.min=a.getStartTime(),this._slider.max=a.getEndTime(),this._slider.value=a.getTime();var i=e.DomEvent.stopPropagation;return e.DomEvent.on(this._slider,"click",i).on(this._slider,"mousedown",i).on(this._slider,"dblclick",i).on(this._slider,"click",e.DomEvent.preventDefault).on(this._slider,"change",o,this).on(this._slider,"mousemove",o,this),a.addCallback(function(e){n._slider.value=e}),t.on("playback:add_tracks",function(){n._slider.min=a.getStartTime(),n._slider.max=a.getEndTime(),n._slider.value=a.getTime()}),this._container}}),e.Playback=e.Playback.Clock.extend({statics:{MoveableMarker:e.Playback.MoveableMarker,Track:e.Playback.Track,TrackController:e.Playback.TrackController,Clock:e.Playback.Clock,Util:e.Playback.Util,TracksLayer:e.Playback.TracksLayer,PlayControl:e.Playback.PlayControl,DateControl:e.Playback.DateControl,SliderControl:e.Playback.SliderControl},options:{tickLen:3e5,speed:1e5,maxInterpolationTime:2592e6,tracksLayer:!1,playControl:!1,dateControl:!1,sliderControl:!1,popups:!0,orientIcons:!0,layer:{},marker:{}},initialize:function(t,o,n,a){e.setOptions(this,a),this._map=t,this._trackController=new e.Playback.TrackController(t,null,this.options),e.Playback.Clock.prototype.initialize.call(this,this._trackController,n,this.options),this.options.tracksLayer&&(this._tracksLayer=new e.Playback.TracksLayer(t,a)),this.setData(o),this.options.playControl&&(this.playControl=new e.Playback.PlayControl(this),this.playControl.addTo(t)),this.options.sliderControl&&(this.sliderControl=new e.Playback.SliderControl(this),this.sliderControl.addTo(t)),this.options.dateControl&&(this.dateControl=new e.Playback.DateControl(this,a),this.dateControl.addTo(t))},clearData:function(){this._trackController.clearTracks(),this._tracksLayer&&this._tracksLayer.clearLayer()},setData:function(e){this.clearData(),this.addData(e,this.getTime()),this.setCursor(this.getStartTime())},addData:function(t,o){if(t){if(t instanceof Array)for(var n=0,a=t.length;n<a;n++)this._trackController.addTrack(new e.Playback.Track(t[n],this.options),o);else this._trackController.addTrack(new e.Playback.Track(t,this.options),o);this._map.fire("playback:set:data"),this.options.tracksLayer&&this._tracksLayer.addLayer(t)}},destroy:function(){this.clearData(),this.playControl&&this._map.removeControl(this.playControl),this.sliderControl&&this._map.removeControl(this.sliderControl),this.dateControl&&this._map.removeControl(this.dateControl)}}),e.Map.addInitHook(function(){this.options.playback&&(this.playback=new e.Playback(this))}),e.playback=function(t,o,n,a){return new e.Playback(t,o,n,a)},e.Playback});var play_more_InterfacePosList=[],play_more_trackPointList=[],play_more_Tracks=[],play_more_tracklinelayerlist=[],play_more_Track_len,play_more_endtime,play_more_playstate="stop",play_more_default_speed=1,play_more_Track_play_zoom=1,play_more_time_splite=6e4,play_more_speed_ary=[60,2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3],play_more_onedayfinishplaytime=[2e4,18e3,16e3,14e3,12e3,1e4,8e3,6e3,4e3,2e3],play_more_speed_bs=5,play_more_speed_bs_max=10,Playback_markericon_ship=L.icon({iconUrl:"./images/unshipfleetdrive.png",iconSize:[32,32],iconAnchor:[16,16]}),Playback_markericon_typhoon=L.icon({iconUrl:"./images/typhoon.gif",iconSize:[25,25],iconAnchor:[12,12]}),play_more_all_ticks=[],isExcClockCallback=!0,isExcTrackCallback=!0,setSliderValueFun="",setCurSjLabelFun="",playToEndFun="",mymap,playBackControl=null,playback_ext={setMap:function(e){mymap=e},setIsExcColockCall:function(e){isExcClockCallback=e},setIsExcTrackCall:function(e){isExcTrackCallback=e},setSliderValueFunName:function(e){setSliderValueFun=e},setCurSjLabelFunName:function(e){setCurSjLabelFun=e},setPlayToEndFun:function(e){playToEndFun=e},clear_All:function(){playback_ext.clear_InterfacePosList(),playback_ext.clear_trackPointList(),playback_ext.clear_Tracks(),playback_ext.clear_tracklinelayer(),playback_ext.clear_All_all_ticks(),playBackControl=null},clear_InterfacePosList:function(){play_more_InterfacePosList=[]},clear_trackPointList:function(){if(play_more_trackPointList.length>0)for(var e=0;e<play_more_trackPointList.length;e++){var t=play_more_trackPointList[e];if(t.length>0)for(var o=0;o<t.length;o++){var n=t[o];if(null!=n&&"1"==n.isShow){var a=n.marker;mymap.removeLayer(a)}}}play_more_trackPointList=[]},clear_tracklinelayer:function(){if(play_more_tracklinelayerlist.length>0)for(var e=0;e<play_more_tracklinelayerlist.length;e++){var t=play_more_tracklinelayerlist[e];null!=t&&mymap.removeLayer(t)}play_more_tracklinelayerlist=[]},clear_Tracks:function(){null!=playBackControl&&playBackControl.restorePlay(),play_more_Tracks=[]},clear_All_all_ticks:function(){play_more_all_ticks=[]},add_trackByInterfacePosList:function(e,t){if(null!=e&&0!=e.length){play_more_InterfacePosList.push(e);var o={};o.type="Feature",o.geometry={},o.geometry.type="MultiPoint",o.geometry.coordinates=[],o.properties={},o.properties.time=[],o.properties.speed=[],o.properties.heading=[],o.properties.altitude=[],o.properties.horizontal_accuracy=[],o.properties.vertical_accuracy=[],o.dataType=t;for(c=0;c<e.length;c++){var n=e[c].lon/6e5,a=e[c].lat/6e5,i=[];i.push(n),i.push(a),o.geometry.coordinates.push(i);r=1e3*e[c].pos_time;o.properties.time.push(r),o.properties.speed.push(1e3)}play_more_Tracks.push(o);for(var l=[],d={stroke:!1,color:"#ef0300",fillColor:"#ef0300",fillOpacity:1,radius:4},c=0;c<e.length;c++){var n=e[c].lon/6e5,a=e[c].lat/6e5,r=1e3*e[c].pos_time,p=L.latLng(a,n),s=new L.circleMarker(p,d),u={};u.isShow="0",u.marker=s,u.tm=r,l.push(u)}play_more_trackPointList.push(l)}},initPlayBackExt:function(){"1"==playback_ext.initPlayBack()&&(play_more_all_ticks=playBackControl.getTracks()),play_more_Track_len=playBackControl.getTickLen(),play_more_endtime=playBackControl.getEndTime()},calculaTimeCForDay:function(){for(var e=0,t=0,o=0;o<play_more_InterfacePosList.length;o++)for(var n=play_more_InterfacePosList[o],a=0;a<n.length;a++){var i=1e3*n[a].pos_time;0==o&&0==a?(e=i,t=i):i<e?e=i:i>t&&(t=i)}var l=0,d=((t-e)/864e5).toString();if(d.indexOf(".")>=0){var c=d.indexOf(".");d=d.substring(0,c),l=parseInt(d)+1}else l=parseInt(d);return l},setDefaultPlayBl:function(){if(null!=play_more_InterfacePosList)if(0!=play_more_InterfacePosList.length){var e=playback_ext.calculaTimeCForDay();play_more_speed_bs=e<=1?1:e<=2?2:e<=3?3:e<=4?4:e<=5?5:e<=6?6:e<=7?7:e<=8?8:e<=9?9:10}else play_more_speed_bs=1;else play_more_speed_bs=1},calculaPlayTrickZoom:function(){if(0==play_more_speed_bs)return 1;var e=play_more_onedayfinishplaytime[play_more_speed_bs-1],t=864e5/play_more_time_splite/(e/(play_more_time_splite/play_more_default_speed)),o=Math.round(t);return 0==o&&(o=1),1==play_more_speed_bs&&o>1&&(o=1),o},calculaSpeed:function(){return play_more_speed_ary[play_more_speed_bs]},initPlayBack:function(){var e=getplaybackOptions();return null==playBackControl?(e.tickLen=play_more_time_splite,playback=null,playback=new L.Playback(mymap,null,null,e),(playBackControl=new L.Playback.Control(playback,"playback_ext.clockCallback","playback_ext.trackCallback")).setData(play_more_Tracks),play_more_default_speed=playback_ext.calculaSpeed(),playBackControl.setSpeed(play_more_default_speed),play_more_Track_play_zoom=playback_ext.calculaPlayTrickZoom(),playBackControl.setPlayTrickZoom(play_more_Track_play_zoom),"1"):(playBackControl.setData(play_more_Tracks),play_more_default_speed=playback_ext.calculaSpeed(),playBackControl.setSpeed(play_more_default_speed),play_more_Track_play_zoom=playback_ext.calculaPlayTrickZoom(),playBackControl.setPlayTrickZoom(play_more_Track_play_zoom),play_more_all_ticks=playBackControl.getTracks(),"0")},setCursor:function(e){playBackControl.setCursor(e)},play:function(){return"stop"==play_more_playstate?(play_more_playstate="play",playBackControl.play(),"1"):"0"},stop:function(){return"play"==play_more_playstate?(play_more_playstate="stop",playBackControl.stop(),"1"):"0"},restart:function(){"play"==play_more_playstate?(play_more_playstate="stop",playBackControl.stop(),setTimeout(playback_ext.gotoFirstAndPlay,500)):playback_ext.gotoFirstAndPlay()},gotoFirstAndPlay:function(){playBackControl.First(),playback_ext.play()},SlowForward:function(){play_more_speed_bs>0&&(0==(play_more_speed_bs-=1)?(play_more_Track_play_zoom=1,playBackControl.setPlayTrickZoom(play_more_Track_play_zoom)):(play_more_Track_play_zoom=playback_ext.calculaPlayTrickZoom(),playBackControl.setPlayTrickZoom(play_more_Track_play_zoom)),play_more_default_speed=playback_ext.calculaSpeed(),playBackControl.setSpeed(play_more_default_speed))},FastForward:function(){play_more_speed_bs<play_more_speed_bs_max&&(play_more_speed_bs+=1,play_more_Track_play_zoom=playback_ext.calculaPlayTrickZoom(),playBackControl.setPlayTrickZoom(play_more_Track_play_zoom),play_more_default_speed=playback_ext.calculaSpeed(),playBackControl.setSpeed(play_more_default_speed))},PowerRateForward:function(e){play_more_speed_bs=e,play_more_Track_play_zoom=playback_ext.calculaPlayTrickZoom(),playBackControl.setPlayTrickZoom(play_more_Track_play_zoom),play_more_default_speed=playback_ext.calculaSpeed(),playBackControl.setSpeed(play_more_default_speed)},getTracks:function(){return playBackControl.getTracks()},getAlreadyTicks:function(e,t){for(var o=play_more_all_ticks[e],n=[],a=0;a<o.length&&o[a].time<=t;a++){var i=[];i.push(o[a].lat),i.push(o[a].lng),i.push(o[a].time),n.push(i)}return n},initlinelayer:function(){if(0==play_more_tracklinelayerlist.length)for(var e=0;e<100;e++)play_more_tracklinelayerlist.push(null)},showTrackPoint:function(e,t){var o=play_more_trackPointList[e];if(o.length>0)for(var n=0;n<o.length;n++){var a=o[n];if(a.tm<=t){if("0"==a.isShow){i=a.marker;mymap.addLayer(i),a.isShow="1"}}else if("1"==a.isShow){var i=a.marker;mymap.removeLayer(i),a.isShow="0"}}},clockCallback:function(e,t,o){},trackCallback:function(dataaryindex,timestamp,lat,lng){if(isExcTrackCallback&&play_more_all_ticks.length>0){var maplinedata=playback_ext.getAlreadyTicks(dataaryindex,timestamp);playback_ext.initlinelayer();var onlinelayer=play_more_tracklinelayerlist[dataaryindex];if(null!=onlinelayer)onlinelayer.setLatLngs(maplinedata);else{var plolineoption={weight:2,color:"#ef0300"};onlinelayer=new L.Polyline(maplinedata,plolineoption),play_more_tracklinelayerlist[dataaryindex]=onlinelayer,mymap.addLayer(onlinelayer)}}isExcTrackCallback&&playback_ext.showTrackPoint(dataaryindex,timestamp);var timestamp1=timestamp+play_more_Track_len*play_more_Track_play_zoom;if(timestamp1>=play_more_endtime&&(playBackControl.stop(),play_more_playstate="stop",timestamp<play_more_endtime&&playback.setCursor(play_more_endtime),null!=playToEndFun&&""!=playToEndFun)){var callfun=playToEndFun+"()";eval(callfun)}if("play"==play_more_playstate){if(null!=setSliderValueFun&&""!=setSliderValueFun){var callfun=setSliderValueFun+"("+timestamp+")";eval(callfun)}if(null!=setCurSjLabelFun&&""!=setCurSjLabelFun){var curtime=playBackControl.getTime(),callfun=setCurSjLabelFun+"("+curtime+")";eval(callfun)}}}},paly_back_clockCallback_fn,paly_back_trackCallback_fn;L.Playback=L.Playback||{},L.Playback.Control=L.Control.extend({initialize:function(e,t,o){this.playback=e,void 0!==t&&null!=t&&t.length>0&&(paly_back_clockCallback_fn=t,e.addCallback(this._clockCallback)),void 0!==o&&null!=o&&o.length>0&&(paly_back_trackCallback_fn=o,e._trackController.addTrackCallback(this._trackCallback))},getSpeed:function(){return this.playback.getSpeed()},setSpeed:function(e){this.playback.setSpeed(e)},setPlayTrickZoom:function(e){this.playback.setPlayTrickZoom(e)},getStartTime:function(){return this.playback.getStartTime()},getEndTime:function(){return this.playback.getEndTime()},getTime:function(){return this.playback.getTime()},getTickLen:function(){return this.playback.getTickLen()},setCurSj:function(e,t){var o=self._combineDateAndTime(e,t);playback.setCursor(o)},setCursor:function(e){playback.setCursor(e)},play:function(){self.stop(),!1===playback.isPlaying()&&playback.start()},stop:function(){!0===playback.isPlaying()&&playback.stop()},First:function(){var e=this.playback.getStartTime();playback.setCursor(e)},getPreTime:function(e){var t=this.playback.getTime();if(e instanceof Array){for(var o=[],n=0,a=e.length;n<a;n++){for(var i=t,l=0,d=(s=(p=e[n]).properties.time).length;l<d&&s[l]<t;l++)i=s[l];o.push(i)}for(var c=o[0],r=1;r<o.length;r++)o[r]>c&&(c=o[r]);return c}for(var p=e,s=p.properties.time,c=t,l=0,d=s.length;l<d&&s[l]<t;l++)c=s[l];return c},Pre:function(e){var t=this.getPreTime(e);t<this.playback.getTime()&&playback.setCursor(t)},getNextTime:function(e){var t=this.playback.getTime();if(e instanceof Array){for(var o=[],n=0,a=e.length;n<a;n++){for(var i=t,l=0,d=(u=(s=e[n]).properties.time).length;l<d;l++)if(u[l]>t){i=u[l];break}o.push(i)}for(var c=[],r=0;r<o.length;r++)o[r]>t&&c.push(o[r]);if(0==c.length)return t;if(1==c.length)return c[0];for(var p=c[0],r=1;r<c.length;r++)c[r]<p&&(p=c[r]);return p}for(var s=e,u=s.properties.time,p=t,l=0,d=u.length;l<d;l++)if(u[l]>t){p=u[l];break}return pretime},Next:function(e){var t=this.getNextTime(e);t>this.playback.getTime()&&playback.setCursor(t)},Last:function(){var e=this.playback.getEndTime();playback.setCursor(e)},restorePlay:function(){!0===playback.isPlaying()&&playback.stop(),playback.clearData()},setData:function(e){playback.setData(e)},getTracks:function(){this.playback.getStartTime(),this.playback.getEndTime();for(var e=this.playback._trackController.getTracks(),t=[],o=0;o<e.length;o++){var n=e[o]._ticks,a=[];for(var i in n)a.push(i);for(var l=[],d=0;d<a.length;d++){var c=parseInt(a[d]),r=n[c];if(void 0===r);else{var p={};p.time=c,p.lat=r[1],p.lng=r[0],l.push(p)}}t.push(l)}return t},getTracksByTime:function(e){this.playback.getStartTime();for(var t=e,o=this.playback._trackController.getTracks(),n=[],a=0;a<o.length;a++){var i=o[a]._ticks,l=[];for(var d in i)l.push(d);for(var c=[],r=0;r<l.length;r++){var p=parseInt(l[r]),s=i[p];if(void 0===s);else if(p<=t){var u={};u.time=p,u.lat=s[1],u.lng=s[0],c.push(u)}}n.push(c)}return n},_clockCallback:function(ms){var sjdate=L.Playback.Util.DateStr(ms),sjtime=L.Playback.Util.TimeStr(ms),callfun=paly_back_clockCallback_fn+'("'+sjdate+'","'+sjtime+'",'+ms+")";eval(callfun)},_trackCallback:function(dataaryindex,timestamp,lat,lng){var callfun=paly_back_trackCallback_fn+"("+dataaryindex+","+timestamp+","+lat+","+lng+")";eval(callfun)},_combineDateAndTime:function(e,t){var o=e.getFullYear(),n=e.getMonth(),a=e.getDate(),i=t.hours||t.hour;"PM"===t.meridian&&12!==i&&(i+=12);var l=t.minutes||t.minute,d=t.seconds||t.second;return new Date(o,n,a,i,l,d).getTime()}});var deduction_mapstate=1,play_more_isShowPlayback=!1,deduction={deduction_info:new Object,initStoreInfo:function(){deduction.deduction_info.selectShipMmsi="",deduction.deduction_info.selectShipName="",deduction.deduction_info.selectTyphoonStormId="",deduction.deduction_info.selectTyphoonName="",deduction.deduction_info.selectVoyageTemplateId="",deduction.deduction_info.selectVoyageTemplateName="",deduction.deduction_info.fleetShipAry=[],deduction.deduction_info.voyageTemplateAry=[],deduction.deduction_info.typhoonAry=[],deduction.deduction_info.shipTrackAll=[],deduction.deduction_info.shipTrackMapObjLine=[],deduction.deduction_info.shipTrackMapObjPoint=[]},getFleetInfo:function(){for(var e=0;e<curShipFleet.length;e++){var t=curShipFleet[e];deduction.deduction_info.fleetShipAry.push(t)}},getTyphoon:function(){if(null!=total_typhoon_array&&total_typhoon_array.length>0)for(var e=0;e<total_typhoon_array.length;e++){var t=total_typhoon_array[e],o={};o.typhoon_name=t.typhoon_name;var n=[];if(null!=t.presentdata&&t.presentdata.length>0)for(var a=0;a<t.presentdata.length;a++){o.stormId=t.presentdata[a].stormId;var i=6e5*t.presentdata[a].lat,l=6e5*t.presentdata[a].lon,d=t.presentdata[a].presentTime;d/=1e3;var c={};c.lat=parseInt(i),c.lon=parseInt(l),c.pos_time=d,n.push(c)}if(null!=t.forecastdata&&t.forecastdata.length>0)for(var r=0;r<t.forecastdata.length;r++){var p={};p.typhoon_name=o.typhoon_name,p.stormId=o.stormId;for(var s=[],u=0;u<n.length;u++)s.push(n[u]);for(var _=t.forecastdata[r].storm,h=0;h<_.length;h++){var i=6e5*_[h].lat,l=6e5*_[h].lon,d=_[h].forecastTime;d/=1e3;var y={};y.lat=parseInt(i),y.lon=parseInt(l),y.pos_time=d,s.push(y)}p.playpoints=s,p.playpoints_d=s,deduction.deduction_info.typhoonAry.push(p)}else o.playpoints=n,o.playpoints_d=n,deduction.deduction_info.typhoonAry.push(o)}},getVoyageTemplate:function(){deduction.deduction_info.voyageTemplateAry=[];var e=L.Config._SERVICE_URL+"/deduction/selectVoyageTemplate",t=$.cookie("__key"),o={};o.cookevalue=t,$.ajax({url:e,data:o,type:"POST",dataType:"json",async:!1,success:function(e){if(null!=e.data&&e.data.length>0)for(var t=e.data,o=0;o<t.length;o++){var n=t[o],a={};a.id=n.id,""==n.departurePort||Lg.enStatu?a.showtext=n.departComPort:a.showtext=n.departurePort,a.showtext=a.showtext+"-",""==n.destinationPort||Lg.enStatu?a.showtext=a.showtext+n.destiComPort:a.showtext=a.showtext+n.destinationPort,deduction.deduction_info.voyageTemplateAry.push(a)}}})},closeAllFleetShipIcon:function(){document.getElementById("ship_choose_all").checked&&$("#ship_choose_all").click();var e=deduction.getSelectTyphoonList();if(e.length>0){var t=e[0].typhoon_name;if(null!=total_typhoon_array&&total_typhoon_array.length>0)for(var o=0;o<total_typhoon_array.length;o++){var n=total_typhoon_array[o];if(n.typhoon_name==t)if(0==$("input[tyhoon_name='"+total_typhoon_array[o].typhoon_name+"']")[0].checked){i=LS.mymap;null!=n.solidLine&&i.addLayer(n.solidLine);for(l=0;l<n.forecastline.length;l++)i.addLayer(n.forecastline[l]);null!=n.pgroup_layer&&i.addLayer(n.pgroup_layer),null!=n.fgroup_layer&&i.addLayer(n.fgroup_layer)}else for(var a=n.circle_marker,i=LS.mymap,l=0;l<a.length;l++)i.removeLayer(a[l])}}},showAllFleetShipIcon:function(){document.getElementById("ship_choose_all").checked||$("#ship_choose_all").click();var e=deduction.getSelectTyphoonList();if(e.length>0){var t=e[0].typhoon_name;if(null!=total_typhoon_array&&total_typhoon_array.length>0)for(var o=0;o<total_typhoon_array.length;o++){var n=total_typhoon_array[o];if(n.typhoon_name==t)if(0==$("input[tyhoon_name='"+total_typhoon_array[o].typhoon_name+"']")[0].checked){i=LS.mymap;null!=n.solidLine&&i.removeLayer(n.solidLine);for(l=0;l<n.forecastline.length;l++)i.removeLayer(n.forecastline[l]);null!=n.pgroup_layer&&i.removeLayer(n.pgroup_layer),null!=n.fgroup_layer&&i.removeLayer(n.fgroup_layer)}else for(var a=n.circle_marker,i=LS.mymap,l=0;l<a.length;l++)i.addLayer(a[l])}}},getShipTrackInfo:function(shipmmsi,departdatetime,voygenTempId,finishcallfun){for(var tempary=[],i=0;i<deduction.deduction_info.shipTrackAll.length;i++){var oneshiptrackinfo=deduction.deduction_info.shipTrackAll[i];oneshiptrackinfo.mmsi!=shipmmsi&&tempary.push(oneshiptrackinfo)}deduction.deduction_info.shipTrackAll=tempary;for(var shipobj=null,i=0;i<deduction.deduction_info.fleetShipAry.length;i++){var exitone=deduction.deduction_info.fleetShipAry[i];if(exitone.mmsi==shipmmsi){shipobj=exitone;break}}var shipTrackInfo={};if(shipTrackInfo.mmsi=shipmmsi,shipTrackInfo.voygentempid=voygenTempId,null!=shipobj){shipTrackInfo.shipExit="1";var lat=parseInt(shipobj.lat);shipTrackInfo.lat=lat;var lon=parseInt(shipobj.lon);shipTrackInfo.lng=lon,shipTrackInfo.pos_time=parseInt(shipobj.pos_time),""!=shipobj.course?shipTrackInfo.course=parseFloat(shipobj.course):""!=shipobj.heading?shipTrackInfo.course=parseFloat(shipobj.heading):shipTrackInfo.course="",shipTrackInfo.speed=shipobj.speed}else shipTrackInfo.shipExit="0";var voygentemppoint=[];if(null!=shipobj&&null!=voygenTempId&&""!=voygenTempId){var lat=parseInt(shipobj.lat);lat/=6e5;var lng=parseInt(shipobj.lon);lng/=6e5;var url=L.Config._SERVICE_URL+"/deduction/selectVoyageTemplateNodeByLatLng";$.ajax({url:url,data:{voygentempid:voygenTempId,lat:lat,lng:lng},type:"POST",dataType:"json",async:!1,success:function(e){if(0==e.status&&null!=e.data&&e.data.length>0)for(var t=e.data,o=0;o<t.length;o++){var n=t[o],a={};a.lat=n.latitude,a.lon=n.longitude,a.voyageval=n.voyageval,voygentemppoint.push(a)}}})}shipTrackInfo.voygentemppoint=voygentemppoint;var shipCurVoyageAry=[];if(shipTrackInfo.curvoyagepoint=shipCurVoyageAry,null!=shipobj&&null!=departdatetime&&""!=departdatetime){loadingfunc(Lg.getContent("all_loading"));var url=L.Config._SERVICE_URL+"/ship/selectCurVoyage";$.ajax({url:url,data:{shipmmsi:shipmmsi,departtime:departdatetime},type:"POST",dataType:"json",success:function(data){if(0==data.status){if(null!=data.data&&data.data.length>0){for(var curvoyagedata=data.data,i=0;i<curvoyagedata.length;i++){var oneobj=curvoyagedata[i],newobj={};newobj.lat=oneobj.lat,newobj.lon=oneobj.lon,newobj.pos_time=parseInt(oneobj.pos_time),shipCurVoyageAry.push(newobj),i==curvoyagedata.length-1&&(shipTrackInfo.lat=newobj.lat,shipTrackInfo.lng=newobj.lon,shipTrackInfo.pos_time=newobj.pos_time,null!=oneobj.course&&""!=oneobj.course?shipTrackInfo.course=parseFloat(oneobj.course):null!=oneobj.heading&&""!=oneobj.heading?shipTrackInfo.course=parseFloat(oneobj.heading):shipTrackInfo.course=0)}shipTrackInfo.curvoyagepoint=shipCurVoyageAry}if(deduction.deduction_info.shipTrackAll.push(shipTrackInfo),dispalyfunc(),""!=finishcallfun){var callfun=finishcallfun+"()";eval(callfun)}}else alert("获取航次数据失败！"),dispalyfunc(),deduction.showAllFleetShipIcon()},error:function(e){alert("获取航次数据失败！"),dispalyfunc(),deduction.showAllFleetShipIcon()}})}else if(shipTrackInfo.curvoyagepoint=shipCurVoyageAry,deduction.deduction_info.shipTrackAll.push(shipTrackInfo),""!=finishcallfun){var callfun=finishcallfun+"()";eval(callfun)}},HcshipTrack:function(e){for(var t=0;t<deduction.deduction_info.shipTrackAll.length;t++){var o=deduction.deduction_info.shipTrackAll[t];if(o.hctrickpoint=[],"1"==o.shipExit){for(var n=0;n<o.curvoyagepoint.length;n++)o.hctrickpoint.push(o.curvoyagepoint[n]);if(null!=o.voygentempid&&""!=o.voygentempid){var a=o.pos_time;if(o.curvoyagepoint.length>0&&(a=o.curvoyagepoint[o.curvoyagepoint.length-1].pos_time),o.voygentemppoint.length>0)for(var i=0;i<o.voygentemppoint.length;i++){var l=o.voygentemppoint[i];(s={}).lat=l.lat,s.lon=l.lon;var d=l.voyageval/e;d=60*d*60,a+=parseInt(d),s.pos_time=a,o.hctrickpoint.push(s)}}else{var c=0;if(""!=o.speed&&(c=parseFloat(o.speed)),""==o.course||c<=3);else{var r=GpsUtil.createGpsPoint(o.lat,o.lng,e,o.course,o.pos_time,24);if(r.length>1)for(var p=1;p<r.length;p++){var s={};s.lat=r[p].latitude,s.lon=r[p].longitude,s.pos_time=r[p].Coursetime,o.hctrickpoint.push(s)}}}o.hctrickpoint=GpsUtil.Lon180Unit(o.hctrickpoint),o.hctrickpoint_d=o.hctrickpoint}}},gpsPy:function(e){for(var t=[],o=0;o<e.length;o++){var n=e[o],a=L.latLng(n.lat/L.Config.LAT_LON_CONVSERSION,n.lon/L.Config.LAT_LON_CONVSERSION),i=L.GPS.transform(a.lat,a.lng),l={};l.lat=i[0]*L.Config.LAT_LON_CONVSERSION,l.lon=i[1]*L.Config.LAT_LON_CONVSERSION,l.pos_time=n.pos_time,t.push(l)}return t},formatDateFULL:function(e){return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},getDateFromformatFull:function(e){return DateUtils.strToLong(e)},getTimeFromformatFull:function(e){var t=deduction.getDateFromformatFull(e);return t/=1e3},formatDateForLabel1:function(e){e.getFullYear();return(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"/"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},formatDateForLabel2:function(e){e.getFullYear();var t=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,o=e.getDate()<10?"0"+e.getDate():e.getDate(),n=e.getHours()<10?"0"+e.getHours():e.getHours(),a=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes();e.getSeconds(),e.getSeconds();return t+"-"+o+" "+n+":"+a},deduction_window_open:function(e,t){$("#deduction_ship_label").html(""),$("#deduction_typhoon_label").html(""),$("#deduction_voygen_label").html(""),deduction.initStoreInfo(),deduction.deduction_info.selectShipMmsi=e,deduction.deduction_info.selectTyphoonName=t,deduction.getFleetInfo(),deduction.getTyphoon(),deduction.getVoyageTemplate(),playback_ext.setMap(LS.mymap),playback_ext.setSliderValueFunName("deduction.playcontrol_setSliderValue"),playback_ext.setCurSjLabelFunName("deduction.playcontrol_showTime"),playback_ext.setPlayToEndFun("deduction.playcontrol_end"),playback_ext.setIsExcTrackCall(!1);var o="";$("#deduction_ship_select").empty(),$("#deduction_ship_select").append("<option value=''>"+Lg.getContent("all_select")+"</option>");for(i=0;i<deduction.deduction_info.fleetShipAry.length;i++)""==(o=deduction.deduction_info.fleetShipAry[i].shipname)&&(o=deduction.deduction_info.fleetShipAry[i].shipename),""!=o&&(deduction.deduction_info.fleetShipAry[i].mmsi==e&&($("#deduction_ship_label").html(o),deduction.deduction_info.selectShipName=o),$("#deduction_ship_select").append("<option value='"+deduction.deduction_info.fleetShipAry[i].mmsi+"'>"+o+"</option>"));var n="",a="";$("#deduction_typhoon_select").empty(),$("#deduction_typhoon_select").append("<option value=''>"+Lg.getContent("all_select")+"</option>");for(i=0;i<deduction.deduction_info.typhoonAry.length;i++)deduction.deduction_info.typhoonAry[i].typhoon_name==t&&($("#deduction_typhoon_label").html(deduction.deduction_info.typhoonAry[i].typhoon_name),deduction.deduction_info.selectTyphoonStormId=deduction.deduction_info.typhoonAry[i].stormId),n=deduction.deduction_info.typhoonAry[i].typhoon_name,a.indexOf(n+",")<0&&(a=a+n+",",$("#deduction_typhoon_select").append("<option value='"+deduction.deduction_info.typhoonAry[i].stormId+"'>"+n+"</option>"));$("#deduction_voygen_label").hide(),$("#deduction_voygen_label_del").hide(),$("#deduction_voygen_select").show(),$("#deduction_voygen_add").show(),$("#deduction_voygen_select_td").show(),$("#deduction_voygen_select").empty(),$("#deduction_voygen_select").append("<option value=''>"+Lg.getContent("all_select")+"</option>");for(var i=0;i<deduction.deduction_info.voyageTemplateAry.length;i++)$("#deduction_voygen_select").append("<option value='"+deduction.deduction_info.voyageTemplateAry[i].id+"'>"+deduction.deduction_info.voyageTemplateAry[i].showtext+"</option>");deduction.setSjInputValueForInit(e,t);var l=$(window).height()-$("#deduction_set").height()-1;$("#deduction_set").css("top",l);var d=!1;""!=$("#deduction_ship_label").html()?($("#deduction_ship_select").hide(),$("#deduction_ship_label").show(),$("#deduction_ship_label_del").show(),d=!0):($("#deduction_ship_label").hide(),$("#deduction_ship_label_del").hide(),$("#deduction_ship_select").show()),deduction.selectVoygenEnableDis();var c=!1;deduction.deduction_info.typhoonAry.length>0&&""!=$("#deduction_typhoon_label").html()?($("#deduction_typhoon_select").hide(),$("#deduction_typhoon_label").show(),$("#deduction_typhoon_label_del").show(),c=!0):($("#deduction_typhoon_label").hide(),$("#deduction_typhoon_label_del").hide(),$("#deduction_typhoon_select").show());var r=$("#deduction_sj_input").val();(d||c)&&null!=r&&""!=r?$("#deduction_set_startbtn").css("background-color","#3385ff"):$("#deduction_set_startbtn").css("background-color","#adc4e7"),deduction.deduction_info.isChangeSelectShip="1",deduction.deduction_info.isChangeSelectTyphoon="1",deduction.deduction_info.isChangeSelectVoygen="1",$("#deduction_set").show()},setSjInputValueForInit:function(e,t){for(var o=!1,n=0,a=0;a<deduction.deduction_info.fleetShipAry.length;a++)if(deduction.deduction_info.fleetShipAry[a].mmsi==e){null!=deduction.deduction_info.fleetShipAry[a].departTime&&""!=deduction.deduction_info.fleetShipAry[a].departTime&&(o=!0,n=parseInt(deduction.deduction_info.fleetShipAry[a].departTime));break}for(var i=!1,l=0,a=0;a<deduction.deduction_info.typhoonAry.length;a++)if(deduction.deduction_info.typhoonAry[a].typhoon_name==t){i=!0,l=(typhoonname=deduction.deduction_info.typhoonAry[a].playpoints)[0].pos_time;break}d=(new Date).getTime()/1e3;if(o&&i){d=l;n<l&&(d=n)}else if(o)d=n;else if(i)var d=l;var c=new Date;c.setTime(1e3*d),$("#deduction_sj_input").val(deduction.formatDateFULL(c))},clickPlaySetArrowRight:function(){$("#deduction_set_td_left").is(":hidden")?($("#deduction_set_td_left").show(),$("#deduction_set").css("width",305),$("#img_deduction_set_arrow").attr("src","./images/arrow_left.png")):($("#deduction_set_td_left").hide(),$("#deduction_set").css("width",30),$("#img_deduction_set_arrow").attr("src","./images/arrow_right.png"))},clickDelShip:function(){$("#deduction_ship_label").hide(),$("#deduction_ship_label_del").hide(),$("#deduction_ship_select").show(),deduction.deduction_info.isChangeSelectShip="0",$("#deduction_ship_select").val(""),deduction.deduction_info.selectShipMmsi="",deduction.deduction_info.selectShipName="",deduction.deduction_info.isChangeSelectShip="1",deduction.setUiSetStartBtnState(),deduction.selectVoygenEnableDis()},clickDelTyphoon:function(){$("#deduction_typhoon_label").hide(),$("#deduction_typhoon_label_del").hide(),$("#deduction_typhoon_select").show(),deduction.deduction_info.isChangeSelectTyphoon="0",$("#deduction_typhoon_select").val(""),deduction.deduction_info.selectTyphoonStormId="",deduction.deduction_info.selectTyphoonName="",deduction.deduction_info.isChangeSelectTyphoon="1",deduction.setUiSetStartBtnState()},clickDelVoygen:function(){$("#deduction_voygen_label").hide(),$("#deduction_voygen_label_del").hide(),$("#deduction_voygen_select").show(),$("#deduction_voygen_add").show(),$("#deduction_voygen_select_td").show(),deduction.deduction_info.isChangeSelectVoygen="0",$("#deduction_voygen_select").val(""),deduction.deduction_info.selectVoyageTemplateId="",deduction.deduction_info.selectVoyageTemplateName="",deduction.deduction_info.isChangeSelectVoygen="1"},selectVoygenEnableDis:function(){""==deduction.deduction_info.selectShipMmsi?($("#deduction_voygen_label").hide(),$("#deduction_voygen_label_del").hide(),$("#deduction_voygen_select").show(),$("#deduction_voygen_add").show(),$("#deduction_voygen_select_td").show(),deduction.deduction_info.isChangeSelectVoygen="0",$("#deduction_voygen_select").val(""),deduction.deduction_info.selectVoyageTemplateId="",deduction.deduction_info.selectVoyageTemplateName="",deduction.deduction_info.isChangeSelectVoygen="1",$("#deduction_voygen_select").attr("disabled","disabled"),$("#deduction_voygen_select").css("background-color","#e4e7e8"),$("#deduction_voygen_add").css("color","#e4e7e8")):($("#deduction_voygen_select").removeAttr("disabled"),$("#deduction_voygen_select").css("background-color","#ffffff"),$("#deduction_voygen_add").css("color","#508bbe"))},selectShipChange:function(){void 0!==deduction.deduction_info.isChangeSelectShip&&"0"!=typeof deduction.deduction_info.isChangeSelectShip&&(deduction.deduction_info.selectShipMmsi=$("#deduction_ship_select").val(),deduction.deduction_info.selectShipName=$("#deduction_ship_select").find("option:selected").text(),""==deduction.deduction_info.selectShipMmsi?deduction.deduction_info.selectShipName="":($("#deduction_ship_label").html(deduction.deduction_info.selectShipName),$("#deduction_ship_select").hide(),$("#deduction_ship_label").show(),$("#deduction_ship_label_del").show()),deduction.setUiSetStartBtnState(),deduction.selectVoygenEnableDis())},selectTyphoonChange:function(){void 0!==deduction.deduction_info.isChangeSelectTyphoon&&"0"!=typeof deduction.deduction_info.isChangeSelectTyphoon&&(deduction.deduction_info.selectTyphoonStormId=$("#deduction_typhoon_select").val(),deduction.deduction_info.selectTyphoonName=$("#deduction_typhoon_select").find("option:selected").text(),""==deduction.deduction_info.selectTyphoonStormId?deduction.deduction_info.selectTyphoonName="":($("#deduction_typhoon_label").html(deduction.deduction_info.selectTyphoonName),$("#deduction_typhoon_select").hide(),$("#deduction_typhoon_label").show(),$("#deduction_typhoon_label_del").show()),deduction.setUiSetStartBtnState())},selectVoygenChange:function(){void 0!==deduction.deduction_info.isChangeSelectVoygen&&"0"!=typeof deduction.deduction_info.isChangeSelectVoygen&&(deduction.deduction_info.selectVoyageTemplateId=$("#deduction_voygen_select").val(),deduction.deduction_info.selectVoyageTemplateName=$("#deduction_voygen_select").find("option:selected").text(),""==deduction.deduction_info.selectVoyageTemplateId?deduction.deduction_info.selectVoyageTemplateName="":($("#deduction_voygen_label").html(deduction.deduction_info.selectVoyageTemplateName),$("#deduction_voygen_select").hide(),$("#deduction_voygen_add").hide(),$("#deduction_voygen_select_td").hide(),$("#deduction_voygen_label").show(),$("#deduction_voygen_label_del").show()))},setUiSetStartBtnState:function(){var e=!1;""!=deduction.deduction_info.selectShipMmsi&&(e=!0);var t=!1;""!=deduction.deduction_info.selectTyphoonStormId&&(t=!0);var o=$("#deduction_sj_input").val();(e||t)&&null!=o&&""!=o?$("#deduction_set_startbtn").css("background-color","#3385ff"):$("#deduction_set_startbtn").css("background-color","#adc4e7"),deduction.setSjInputValueForInit(deduction.deduction_info.selectShipMmsi,deduction.deduction_info.selectTyphoonName)},voyagenTemplateAdd:function(){"rgb(228, 231, 232)"!=$("#deduction_voygen_add").css("color")&&(voyage_plan_add_open_source_deduction="1",voyage_plan_add.open_addwindow())},voyagenTemplateAddFinish:function(e){deduction.getVoyageTemplate(),$("#deduction_voygen_select").empty(),$("#deduction_voygen_select").append("<option value=''>"+Lg.getContent("all_select")+"</option>");for(var t=0;t<deduction.deduction_info.voyageTemplateAry.length;t++)$("#deduction_voygen_select").append("<option value='"+deduction.deduction_info.voyageTemplateAry[t].id+"'>"+deduction.deduction_info.voyageTemplateAry[t].showtext+"</option>");$("#deduction_voygen_select").val(e),deduction.selectVoygenChange()},deduction_window_close:function(){deduction.initStoreInfo(),$("#deduction_set").hide()},show_playcontrolUi:function(){if("rgb(173, 196, 231)"!=$("#deduction_set_startbtn").css("background-color")){deduction.deduction_info.isChangeSpeed=!0;var e=$("#deduction_playcontrol_speed").val();parseFloat(e)<=0&&(deduction.deduction_info.isChangeSpeed=!1,$("#deduction_playcontrol_speed").val(10),deduction.deduction_info.isChangeSpeed=!0),$("#deduction_set").hide(),deduction.deduction_info.shipTrackAll=[];var t=deduction.deduction_info.selectShipMmsi,o=$("#deduction_sj_input").val();if(null!=t&&""!=t&&null!=o&&""!=o){var n=deduction.getTimeFromformatFull(o),a=deduction.deduction_info.selectVoyageTemplateId;deduction.getShipTrackInfo(t,n,a,"deduction.show_playcontrolUi_Ext")}else deduction.show_playcontrolUi_Ext();L.CNZZ.playTyphoonStart()}},show_playcontrolUi_Ext:function(){deduction_mapstate=LS.maptype,deduction.closeAllFleetShipIcon(),play_more_isShowPlayback=!0;var e=$(window).height()-$("#deduction_playcontrol").height()-1;$("#deduction_playcontrol").css("top",e);var t=$(window).width();$("#deduction_playcontrol").css("width",t);var o=$(window).width()-20;$("#deduction_playcontrol_td_left").css("width",o),$("#deduction_playcontrol").show(),deduction.playcontrol_encontrol(),deduction.deduction_info.isChangeCurSjLabelAndSliderValue="1";a=parseFloat($("#deduction_playcontrol_speed").val());if(deduction.HcshipTrack(a),deduction.playcontrol_datainit(!0),null!=play_more_InterfacePosList&&play_more_InterfacePosList.length>0){var n=playBackControl.getStartTime();deduction.setSliderInfo(n);var a=parseFloat($("#deduction_playcontrol_speed").val());deduction.HcshipTrack(a),deduction.deduction_info.isChangeTrackCheck=!1,deduction.playcontrol_clearMapObj(),deduction.playcontrol_createMapObj(),document.getElementById("deduction_playcontrol_checkbox").checked=!0,deduction.playcontrol_showMapObj(),deduction.deduction_info.isChangeTrackCheck=!0,deduction.playcontrol_discontrol(),$("#deduction_playcontrol_curSlBs").html(play_more_speed_bs),$("#img_deduction_playcontrol_startzt").attr("src","images/play_control_suspended.png"),setTimeout(playback_ext.gotoFirstAndPlay,700),deduction.zoomMapToBand()}else alert("选择的时间范围没有轨迹数据！"),deduction.close_playcontrolUiClick()},zoomMapToBand:function(){for(var e=0,t=0,o=0,n=0,a=!1,i=deduction.getSelectTyphoonList(),l=0;l<i.length;l++)for(var d=i[l].playpoints,c=0;c<d.length;c++){var r=d[c].lon/6e5,p=d[c].lat/6e5;a?(r<e?e=r:r>t&&(t=r),p<o?o=p:p>n&&(n=p)):(e=r,t=r,o=p,n=p),a=!0}if(deduction.deduction_info.shipTrackAll.length>0)for(l=0;l<deduction.deduction_info.shipTrackAll.length;l++)for(var d=deduction.deduction_info.shipTrackAll[l].hctrickpoint,c=0;c<d.length;c++){var r=d[c].lon/6e5,p=d[c].lat/6e5;a?(r<e?e=r:r>t&&(t=r),p<o?o=p:p>n&&(n=p)):(e=r,t=r,o=p,n=p),a=!0}if(a){var s=L.latLng(o,e),u=L.latLng(n,t),_=L.latLngBounds(s,u);LS.mymap.fitBounds(_)}},playcontrol_clearMapObjStore:function(){deduction.deduction_info.shipTrackMapObjLine=[],deduction.deduction_info.shipTrackMapObjPoint=[]},playcontrol_createMapObj:function(){if(deduction.playcontrol_clearMapObjStore(),null!=deduction.deduction_info.shipTrackAll&&0!=deduction.deduction_info.shipTrackAll.length)for(var e=playback_ext.getTracks(),t=0;t<deduction.deduction_info.shipTrackAll.length;t++){var o=e[t],n=deduction.deduction_info.shipTrackAll[t].hctrickpoint,a=deduction.deduction_info.shipTrackAll[t].curvoyagepoint.length,i=deduction.deduction_info.shipTrackAll[t].voygentempid,l={stroke:!1,color:"#ef0300",fillColor:"#ef0300",fillOpacity:1,radius:2},d={stroke:!1,color:"#00ff00",fillColor:"#00ff00",fillOpacity:1,radius:2};if(null!=deduction.deduction_info.shipTrackAll[t].curvoyagepoint&&deduction.deduction_info.shipTrackAll[t].curvoyagepoint.length>0){for(var a=deduction.deduction_info.shipTrackAll[t].curvoyagepoint.length,c=0,r=0;r<a;r++){for(var p=1e3*n[r].pos_time,s=c;s<o.length;s++)if((k=o[s].time)>=p){c=s;break}if(c>=0){var u=o[c].lng,_=o[c].lat;deduction.createMapObjPoint(u,_,l)}}if(null!=i&&""!=i)for(r=a;r<n.length;r++){for(var p=1e3*n[r].pos_time,s=c;s<o.length;s++)if((k=o[s].time)>=p){c=s;break}if(c>=0){var u=o[c].lng,_=o[c].lat;deduction.createMapObjPoint(u,_,d)}}for(var h=1e3*n[a-1].pos_time,y=-1,f=0;f<o.length;f++)if((k=o[f].time)>=h){y=f;break}for(var g=[],r=0;r<=y;r++){var u=o[r].lng,_=o[r].lat,m=deduction.getMapObjLinePoint(u,_);g.push(m[0])}v={weight:2,color:"#ef0300"};deduction.createMapObjLine(g,v),g=[];for(r=y;r<o.length;r++){var u=o[r].lng,_=o[r].lat,m=deduction.getMapObjLinePoint(u,_);g.push(m[0])}v={weight:2,color:"#00ff00"};deduction.createMapObjLine(g,v)}else{if(null!=i&&""!=i)for(var c=0,r=0;r<n.length;r++){for(var p=1e3*n[r].pos_time,s=c;s<o.length;s++){var k=o[s].time;if(k>=p){c=s;break}}if(c>=0){var u=o[c].lng,_=o[c].lat;deduction.createMapObjPoint(u,_,l)}}for(var g=[],r=0;r<o.length;r++){var u=o[r].lng,_=o[r].lat,m=deduction.getMapObjLinePoint(u,_);g.push(m[0])}var v={weight:2,color:"#00ff00"};deduction.createMapObjLine(g,v)}}},getMapObjLinePoint:function(e,t){var o=[];o.push(t),o.push(e);var n=[];return n.push(o),n},createMapObjLine:function(e,t){var o=new L.Polyline(e,t);deduction.deduction_info.shipTrackMapObjLine.push(o)},createMapObjPoint:function(e,t,o){},gpsPyOne:function(e,t){var o=L.GPS.transform(e,t),n={};return n.lat=o[0],n.lon=o[1],n},playcontrol_clearMapObj:function(){var e=LS.mymap;if(deduction.deduction_info.shipTrackMapObjPoint.length>0)for(t=0;t<deduction.deduction_info.shipTrackMapObjPoint.length;t++)e.removeLayer(deduction.deduction_info.shipTrackMapObjPoint[t]);if(deduction.deduction_info.shipTrackMapObjLine.length>0)for(var t=0;t<deduction.deduction_info.shipTrackMapObjLine.length;t++)e.removeLayer(deduction.deduction_info.shipTrackMapObjLine[t])},playcontrol_showMapObj:function(){var e=LS.mymap;if(deduction.deduction_info.shipTrackMapObjLine.length>0)for(t=0;t<deduction.deduction_info.shipTrackMapObjLine.length;t++)e.addLayer(deduction.deduction_info.shipTrackMapObjLine[t]);if(deduction.deduction_info.shipTrackMapObjPoint.length>0)for(var t=0;t<deduction.deduction_info.shipTrackMapObjPoint.length;t++)e.addLayer(deduction.deduction_info.shipTrackMapObjPoint[t])},playcontrol_play_zt:function(){var e=$("#img_deduction_playcontrol_startzt")[0].src;e.indexOf("images/play_control_play.png")>=0?deduction.playcontrol_play():deduction.playcontrol_zt(),e.indexOf("images/play_control_play.png")>=0?($("#img_deduction_playcontrol_startzt").attr("title","暂停"),$("#img_deduction_playcontrol_startzt").attr("alt","暂停")):($("#img_deduction_playcontrol_startzt").attr("title","播放"),$("#img_deduction_playcontrol_startzt").attr("alt","播放"))},playcontrol_discontrol:function(){$("#deduction_playcontrol_speed").attr("readonly","readonly")},playcontrol_encontrol:function(){$("#deduction_playcontrol_speed").removeAttr("readonly")},getSelectTyphoonList:function(){for(var e=[],t=deduction.deduction_info.selectTyphoonStormId,o=0;o<deduction.deduction_info.typhoonAry.length;o++)if(deduction.deduction_info.typhoonAry[o].stormId==t){var n=deduction.deduction_info.typhoonAry[o],a={};a.typhoon_name=n.typhoon_name,a.stormId=n.stormId,a.playpoints=deduction.getSelectTyphoonListForPoint(n.playpoints),a.playpoints_d=deduction.getSelectTyphoonListForPoint(n.playpoints_d),e.push(a)}return e},getSelectTyphoonListForPoint:function(e){for(var t=$("#deduction_sj_input").val(),o=deduction.getTimeFromformatFull(t),n=[],a=0;a<e.length;a++)e[a].pos_time>=o&&n.push(e[a]);return n},addAllPlayDataToPlayControl:function(){if(deduction.deduction_info.shipTrackAll.length>0)for(o=0;o<deduction.deduction_info.shipTrackAll.length;o++){var e=deduction.deduction_info.shipTrackAll[o];1!=LS.maptype?(e.hctrickpoint=[],e.hctrickpoint=deduction.gpsPy(e.hctrickpoint_d)):(e.hctrickpoint=[],e.hctrickpoint=e.hctrickpoint_d),playback_ext.add_trackByInterfacePosList(e.hctrickpoint,"ship")}for(var t=deduction.getSelectTyphoonList(),o=0;o<t.length;o++)1!=LS.maptype?t[o].playpoints=deduction.gpsPy(t[o].playpoints_d):t[o].playpoints=t[o].playpoints_d,null!=t[o].playpoints&&t[o].playpoints.length>0&&playback_ext.add_trackByInterfacePosList(t[o].playpoints,"typhoon")},playcontrol_datainit:function(e){if(playback_ext.clear_All(),deduction.addAllPlayDataToPlayControl(),null!=play_more_InterfacePosList&&play_more_InterfacePosList.length>0){if(playback_ext.initPlayBackExt(),e){playback_ext.setDefaultPlayBl();var t=playback_ext.calculaSpeed();playBackControl.setSpeed(t),play_more_Track_play_zoom=playback_ext.calculaPlayTrickZoom(),playBackControl.setPlayTrickZoom(play_more_Track_play_zoom)}var o=playBackControl.getStartTime(),n=playBackControl.getEndTime(),a=playBackControl.getTime(),i=new Date(o);$("#deduction_playcontrol_minsj").val(deduction.formatDateForLabel2(i));var l=new Date(n);$("#deduction_playcontrol_maxsj").val(deduction.formatDateForLabel2(l));var d=new Date(a);$("#deduction_playcontrol_cursj").val(deduction.formatDateForLabel2(d))}},mapObjInit:function(){deduction.playcontrol_clearMapObj(),deduction.playcontrol_createMapObj(),document.getElementById("deduction_playcontrol_checkbox").checked&&deduction.playcontrol_showMapObj()},setSliderInfo:function(e){var t=playBackControl.getStartTime(),o=playBackControl.getEndTime(),n=playBackControl.getTickLen();$("#staeplayback_playcontrol_slider").slider({min:t,max:o,step:n,value:e,range:"min",slide:function(e,t){playback.setCursor(t.value),deduction.playcontrol_showTime(t.value)}}),$("#staeplayback_playcontrol_slider").slider("value",e)},playcontrol_play:function(){var e=$("#deduction_playcontrol_speed").val();parseFloat(e)<=0?alert("航速必须大于0！"):(deduction.playcontrol_discontrol(),$("#img_deduction_playcontrol_startzt").attr("src","images/play_control_suspended.png"),playBackControl.getTime()<playBackControl.getEndTime()?playback_ext.play():playback_ext.gotoFirstAndPlay())},playcontrol_end:function(){$("#img_deduction_playcontrol_startzt").attr("src","images/play_control_play.png"),deduction.playcontrol_encontrol()},playcontrol_zt:function(){playback_ext.stop(),deduction.playcontrol_encontrol(),$("#img_deduction_playcontrol_startzt").attr("src","images/play_control_play.png")},playcontrol_kb:function(){playback_ext.FastForward(),$("#deduction_playcontrol_curSlBs").html(play_more_speed_bs)},playcontrol_mb:function(){if(1==play_more_speed_bs){var e=playBackControl.getStartTime(),t=0,o=((playBackControl.getEndTime()-e)/864e5).toString();if(o.indexOf(".")>=0){var n=o.indexOf(".");o=o.substring(0,n),t=parseInt(o)+1}else t=parseInt(o);if(t>3)return}playback_ext.SlowForward(),$("#deduction_playcontrol_curSlBs").html(play_more_speed_bs)},playcontrol_showTime:function(e){var t=new Date(e),o=deduction.formatDateForLabel1(t);$("#deduction_playcontrol_cursj").val(o)},playcontrol_setSliderValue:function(e){void 0!==deduction.deduction_info.isChangeCurSjLabelAndSliderValue&&"0"!=deduction.deduction_info.isChangeCurSjLabelAndSliderValue&&$("#staeplayback_playcontrol_slider").slider("value",e)},playcontrol_shiptrickCheckClick:function(){deduction.deduction_info.isChangeTrackCheck&&(document.getElementById("deduction_playcontrol_checkbox").checked?deduction.playcontrol_showMapObj():deduction.playcontrol_clearMapObj())},speedchange:function(){if(deduction.deduction_info.isChangeSpeed){var e=$("#deduction_playcontrol_speed").val();if(parseFloat(e)<=0)return void alert("航速必须大于0！");var t=parseFloat($("#deduction_playcontrol_speed").val());t>50&&($("#deduction_playcontrol_speed").val(50),t=parseFloat($("#deduction_playcontrol_speed").val())),deduction.HcshipTrack(t),deduction.playcontrol_datainit(!1),deduction.mapObjInit();var o=playBackControl.getStartTime();deduction.setSliderInfo(o)}},mapchange:function(){1==deduction_mapstate?1!=LS.maptype&&null!=playBackControl&&setTimeout(deduction.mapchangeExc,50):1==LS.maptype&&null!=playBackControl&&setTimeout(deduction.mapchangeExc,50),deduction_mapstate=LS.maptype},mapchangeExc:function(){var e=play_more_playstate;"play"==e&&playback_ext.stop(),deduction.deduction_info.isChangeCurSjLabelAndSliderValue="0";var t=playBackControl.getTime();deduction.playcontrol_datainit(!1),deduction.playcontrol_clearMapObj(),deduction.playcontrol_createMapObj(),document.getElementById("deduction_playcontrol_checkbox").checked&&deduction.playcontrol_showMapObj(),deduction.setSliderInfo(t),playback_ext.setCursor(t),"play"==e&&playback_ext.play(),deduction.deduction_info.isChangeCurSjLabelAndSliderValue="1"},windowReSize:function(){e=$(window).height()-$("#deduction_set").height()-1;$("#deduction_set").css("top",e);var e=$(window).height()-$("#deduction_playcontrol").height()-1;$("#deduction_playcontrol").css("top",e);var t=$(window).width();t<500&&(t=500),$("#deduction_playcontrol").css("width",t);var o=$(window).width()-20;$("#deduction_playcontrol_td_left").css("width",o)},speedinput:function(){var e=parseFloat($("#deduction_playcontrol_speed").val());e>50&&$("#deduction_playcontrol_speed").val(50),e<1&&$("#deduction_playcontrol_speed").val(1)},close_playcontrolUiClick:function(){"1"==playback_ext.stop()?setTimeout(deduction.close_playcontrolUi,500):deduction.close_playcontrolUi()},close_playcontrolUi:function(){playback_ext.clear_All(),deduction.playcontrol_clearMapObj(),play_more_isShowPlayback=!1,deduction.showAllFleetShipIcon(),$("#deduction_playcontrol").hide();var e=$(window).height()-$("#deduction_set").height()-1;$("#deduction_set").css("top",e),$("#deduction_set").show()}},deduction_mapstate=1,play_more_isShowPlayback=!1,plandeduction={deduction_info:new Object,initStoreInfo:function(){plandeduction.deduction_info.selectShipMmsi="",plandeduction.deduction_info.selectShipName="",plandeduction.deduction_info.selectTyphoonStormId="",plandeduction.deduction_info.selectTyphoonName="",plandeduction.deduction_info.selectVoyageTemplateId="",plandeduction.deduction_info.selectVoyageTemplateName="",plandeduction.deduction_info.fleetShipAry=[],plandeduction.deduction_info.voyageTemplateAry=[],plandeduction.deduction_info.typhoonAry=[],plandeduction.deduction_info.shipTrackAll=[],plandeduction.deduction_info.shipTrackMapObjLine=[],plandeduction.deduction_info.shipTrackMapObjPoint=[]},getFleetInfo:function(){for(var e=0;e<curShipFleet.length;e++){var t=curShipFleet[e];plandeduction.deduction_info.fleetShipAry.push(t)}},getTyphoon:function(){if(null!=total_typhoon_array&&total_typhoon_array.length>0)for(var e=0;e<total_typhoon_array.length;e++){var t=total_typhoon_array[e],o={};o.typhoon_name=t.typhoon_name;var n=[];if(null!=t.presentdata&&t.presentdata.length>0)for(var a=0;a<t.presentdata.length;a++){o.stormId=t.presentdata[a].stormId;var i=6e5*t.presentdata[a].lat,l=6e5*t.presentdata[a].lon,d=t.presentdata[a].presentTime;d/=1e3;var c={};c.lat=parseInt(i),c.lon=parseInt(l),c.pos_time=d,n.push(c)}if(null!=t.forecastdata&&t.forecastdata.length>0)for(var r=0;r<t.forecastdata.length;r++){var p={};p.typhoon_name=o.typhoon_name,p.stormId=o.stormId;for(var s=[],u=0;u<n.length;u++)s.push(n[u]);for(var _=t.forecastdata[r].storm,h=0;h<_.length;h++){var i=6e5*_[h].lat,l=6e5*_[h].lon,d=_[h].forecastTime;d/=1e3;var y={};y.lat=parseInt(i),y.lon=parseInt(l),y.pos_time=d,s.push(y)}p.playpoints=s,p.playpoints_d=s,plandeduction.deduction_info.typhoonAry.push(p)}else o.playpoints=n,o.playpoints_d=n,plandeduction.deduction_info.typhoonAry.push(o)}},getVoyageTemplate:function(){plandeduction.deduction_info.voyageTemplateAry=[];var e=L.Config._SERVICE_URL+"/deduction/selectVoyageTemplate",t=$.cookie("__key"),o={};o.cookevalue=t,$.ajax({url:e,data:o,type:"POST",dataType:"json",async:!1,success:function(e){if(null!=e.data&&e.data.length>0)for(var t=e.data,o=0;o<t.length;o++){var n=t[o],a={};a.id=n.id,""!=n.departurePort?a.showtext=n.departurePort:a.showtext=n.departComPort,a.showtext=a.showtext+"-",""!=n.destinationPort?a.showtext=a.showtext+n.destinationPort:a.showtext=a.showtext+n.destiComPort,plandeduction.deduction_info.voyageTemplateAry.push(a)}}})},closeAllFleetShipIcon:function(){shipeventmoudle.showAndRemoveAllCom(!1),tyhoon_Object.showAndHideCom(!1),voyageplanline.removePredictedShip();var e=plandeduction.getSelectTyphoonList();if(e.length>0){var t=e[0].typhoon_name;if(null!=total_typhoon_array&&total_typhoon_array.length>0)for(var o=0;o<total_typhoon_array.length;o++){var n=total_typhoon_array[o];if(n.typhoon_name==t)if(0==$("input[tyhoon_name='"+total_typhoon_array[o].typhoon_name+"']")[0].checked){i=LS.mymap;null!=n.solidLine&&i.addLayer(n.solidLine);for(l=0;l<n.forecastline.length;l++)i.addLayer(n.forecastline[l]);null!=n.pgroup_layer&&i.addLayer(n.pgroup_layer),null!=n.fgroup_layer&&i.addLayer(n.fgroup_layer)}else for(var a=n.circle_marker,i=LS.mymap,l=0;l<a.length;l++)i.removeLayer(a[l])}}},showAllFleetShipIcon:function(){document.getElementById("ship_choose_all").checked||$("#ship_choose_all").click();var e=plandeduction.getSelectTyphoonList();if(e.length>0){var t=e[0].typhoon_name;if(null!=total_typhoon_array&&total_typhoon_array.length>0)for(var o=0;o<total_typhoon_array.length;o++){var n=total_typhoon_array[o];if(n.typhoon_name==t)if(0==$("input[tyhoon_name='"+total_typhoon_array[o].typhoon_name+"']")[0].checked){i=LS.mymap;null!=n.solidLine&&i.removeLayer(n.solidLine);for(l=0;l<n.forecastline.length;l++)i.removeLayer(n.forecastline[l]);null!=n.pgroup_layer&&i.removeLayer(n.pgroup_layer),null!=n.fgroup_layer&&i.removeLayer(n.fgroup_layer)}else for(var a=n.circle_marker,i=LS.mymap,l=0;l<a.length;l++)i.addLayer(a[l])}}},getShipTrackInfo:function(shipmmsi,departdatetime,voyageshipid,finishcallfun){for(var tempary=[],i=0;i<plandeduction.deduction_info.shipTrackAll.length;i++){var oneshiptrackinfo=plandeduction.deduction_info.shipTrackAll[i];oneshiptrackinfo.mmsi!=shipmmsi&&tempary.push(oneshiptrackinfo)}plandeduction.deduction_info.shipTrackAll=tempary;for(var shipobj=null,i=0;i<plandeduction.deduction_info.fleetShipAry.length;i++){var exitone=plandeduction.deduction_info.fleetShipAry[i];if(exitone.mmsi==shipmmsi){shipobj=exitone;break}}var shipTrackInfo={};if(shipTrackInfo.mmsi=shipmmsi,shipTrackInfo.voygentempid=voyageshipid,null!=shipobj){shipTrackInfo.shipExit="1";var lat=parseInt(shipobj.lat);shipTrackInfo.lat=lat;var lon=parseInt(shipobj.lon);shipTrackInfo.lng=lon,shipTrackInfo.pos_time=parseInt(shipobj.pos_time),""!=shipobj.course?shipTrackInfo.course=parseFloat(shipobj.course):""!=shipobj.heading?shipTrackInfo.course=parseFloat(shipobj.heading):shipTrackInfo.course="",shipTrackInfo.speed=shipobj.speed}else shipTrackInfo.shipExit="0";var voygentemppoint=[];if(null!=shipobj&&null!=voyageshipid&&""!=voyageshipid){var lat=parseInt(shipobj.lat);lat/=6e5;var lng=parseInt(shipobj.lon);lng/=6e5;var url=L.Config._SERVICE_URL+"/deduction/selectVoyageTemplateNodeByVoyageshipid",cookievalue=$.cookie("__key");$.ajax({url:url,data:{voyageshipid:voyageshipid,lat:lat,lng:lng,cookievalue:cookievalue},type:"POST",dataType:"json",async:!1,success:function(e){if(0==e.status&&null!=e.data&&e.data.length>0)for(var t=e.data,o=0;o<t.length;o++){var n=t[o],a={};a.lat=n.latitude,a.lon=n.longitude,a.voyageval=n.voyageval,voygentemppoint.push(a)}}})}shipTrackInfo.voygentemppoint=voygentemppoint;var shipCurVoyageAry=[];if(shipTrackInfo.curvoyagepoint=shipCurVoyageAry,null!=shipobj&&null!=departdatetime&&""!=departdatetime){loadingfunc(Lg.getContent("all_loading"));var url=L.Config._SERVICE_URL+"/ship/selectCurVoyage";$.ajax({url:url,data:{shipmmsi:shipmmsi,departtime:departdatetime},type:"POST",dataType:"json",success:function(data){if(0==data.status){if(null!=data.data&&data.data.length>0){for(var curvoyagedata=data.data,i=0;i<curvoyagedata.length;i++){var oneobj=curvoyagedata[i],newobj={};newobj.lat=oneobj.lat,newobj.lon=oneobj.lon,newobj.pos_time=parseInt(oneobj.pos_time),shipCurVoyageAry.push(newobj),i==curvoyagedata.length-1&&(shipTrackInfo.lat=newobj.lat,shipTrackInfo.lng=newobj.lon,shipTrackInfo.pos_time=newobj.pos_time,null!=oneobj.course&&""!=oneobj.course?shipTrackInfo.course=parseFloat(oneobj.course):null!=oneobj.heading&&""!=oneobj.heading?shipTrackInfo.course=parseFloat(oneobj.heading):shipTrackInfo.course=0)}shipTrackInfo.curvoyagepoint=shipCurVoyageAry}if(plandeduction.deduction_info.shipTrackAll.push(shipTrackInfo),dispalyfunc(),""!=finishcallfun){var callfun=finishcallfun+"()";eval(callfun)}}else alert("获取航次数据失败！"),dispalyfunc(),plandeduction.showAllFleetShipIcon()},error:function(e){alert("获取航次数据失败！"),dispalyfunc(),plandeduction.showAllFleetShipIcon()}})}else if(shipTrackInfo.curvoyagepoint=shipCurVoyageAry,plandeduction.deduction_info.shipTrackAll.push(shipTrackInfo),""!=finishcallfun){var callfun=finishcallfun+"()";eval(callfun)}},HcshipTrack:function(e){for(var t=0;t<plandeduction.deduction_info.shipTrackAll.length;t++){var o=plandeduction.deduction_info.shipTrackAll[t];if(o.hctrickpoint=[],o.planvoygentemppoint=[],"1"==o.shipExit){for(var n=0;n<o.curvoyagepoint.length;n++)o.hctrickpoint.push(o.curvoyagepoint[n]);o.hctrickpoint.length;if(null!=o.voygentempid&&""!=o.voygentempid){var a=o.pos_time;if(o.curvoyagepoint.length>0&&(a=o.curvoyagepoint[o.curvoyagepoint.length-1].pos_time,o.voygentemppoint.length>0)){var i=o.curvoyagepoint[o.curvoyagepoint.length-1];o.planvoygentemppoint.push(i)}if(o.voygentemppoint.length>0)for(var l=0;l<o.voygentemppoint.length;l++){var d=o.voygentemppoint[l];(u={}).lat=d.lat,u.lon=d.lon;var c=d.voyageval/e;c=60*c*60,a+=parseInt(c),u.pos_time=a,o.hctrickpoint.push(u),o.planvoygentemppoint.push(u)}}else{var r=0;if(""!=o.speed&&(r=parseFloat(o.speed)),""==o.course||r<=3);else{var p=GpsUtil.createGpsPoint(o.lat,o.lng,e,o.course,o.pos_time,24);if(p.length>1)for(var s=1;s<p.length;s++){var u={};u.lat=p[s].latitude,u.lon=p[s].longitude,u.pos_time=p[s].Coursetime,o.hctrickpoint.push(u)}}}o.hctrickpoint=GpsUtil.Lon180Unit(o.hctrickpoint),o.hctrickpoint_d=o.hctrickpoint,o.planvoygentemppoint=GpsUtil.Lon180Unit(o.planvoygentemppoint),o.planvoygentemppoint_d=o.planvoygentemppoint}}},gpsPy:function(e){for(var t=[],o=0;o<e.length;o++){var n=e[o],a=L.latLng(n.lat/L.Config.LAT_LON_CONVSERSION,n.lon/L.Config.LAT_LON_CONVSERSION),i=L.GPS.transform(a.lat,a.lng),l={};l.lat=i[0]*L.Config.LAT_LON_CONVSERSION,l.lon=i[1]*L.Config.LAT_LON_CONVSERSION,l.pos_time=n.pos_time,t.push(l)}return t},formatDateFULL:function(e){return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},getDateFromformatFull:function(e){return DateUtils.strToLong(e)},getTimeFromformatFull:function(e){var t=plandeduction.getDateFromformatFull(e);return t/=1e3},formatDateForLabel1:function(e){e.getFullYear();var t=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,o=e.getDate()<10?"0"+e.getDate():e.getDate(),n=e.getHours()<10?"0"+e.getHours():e.getHours(),a=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes();e.getSeconds(),e.getSeconds();return t+"/"+o+" "+n+":"+a},formatDateForLabel2:function(e){e.getFullYear();var t=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,o=e.getDate()<10?"0"+e.getDate():e.getDate(),n=e.getHours()<10?"0"+e.getHours():e.getHours(),a=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes();e.getSeconds(),e.getSeconds();return t+"-"+o+" "+n+":"+a},deduction_window_open:function(e,t){$("#deduction_ship_label").html(""),$("#deduction_typhoon_label").html(""),$("#deduction_voygen_label").html(""),plandeduction.initStoreInfo(),plandeduction.deduction_info.selectShipMmsi=e,plandeduction.deduction_info.selectTyphoonName=t,plandeduction.getFleetInfo(),plandeduction.getTyphoon(),plandeduction.getVoyageTemplate(),playback_ext.setMap(LS.mymap),playback_ext.setSliderValueFunName("plandeduction.playcontrol_setSliderValue"),playback_ext.setCurSjLabelFunName("plandeduction.playcontrol_showTime"),playback_ext.setPlayToEndFun("plandeduction.playcontrol_end"),playback_ext.setIsExcTrackCall(!1);var o="";$("#deduction_ship_select").empty(),$("#deduction_ship_select").append("<option value=''>"+Lg.getContent("all_select")+"</option>");for(i=0;i<plandeduction.deduction_info.fleetShipAry.length;i++)""==(o=plandeduction.deduction_info.fleetShipAry[i].shipname)&&(o=plandeduction.deduction_info.fleetShipAry[i].shipename),""!=o&&(plandeduction.deduction_info.fleetShipAry[i].mmsi==e&&($("#deduction_ship_label").html(o),plandeduction.deduction_info.selectShipName=o),$("#deduction_ship_select").append("<option value='"+plandeduction.deduction_info.fleetShipAry[i].mmsi+"'>"+o+"</option>"));var n="",a="";$("#deduction_typhoon_select").empty(),$("#deduction_typhoon_select").append("<option value=''>"+Lg.getContent("all_select")+"</option>");for(i=0;i<plandeduction.deduction_info.typhoonAry.length;i++)plandeduction.deduction_info.typhoonAry[i].typhoon_name==t&&($("#deduction_typhoon_label").html(plandeduction.deduction_info.typhoonAry[i].typhoon_name),plandeduction.deduction_info.selectTyphoonStormId=plandeduction.deduction_info.typhoonAry[i].stormId),n=plandeduction.deduction_info.typhoonAry[i].typhoon_name,a.indexOf(n+",")<0&&(a=a+n+",",$("#deduction_typhoon_select").append("<option value='"+plandeduction.deduction_info.typhoonAry[i].stormId+"'>"+n+"</option>"));$("#deduction_voygen_label").hide(),$("#deduction_voygen_label_del").hide(),$("#deduction_voygen_select").show(),$("#deduction_voygen_add").show(),$("#deduction_voygen_select_td").show(),$("#deduction_voygen_select").empty(),$("#deduction_voygen_select").append("<option value=''>"+Lg.getContent("all_select")+"</option>");for(var i=0;i<plandeduction.deduction_info.voyageTemplateAry.length;i++)$("#deduction_voygen_select").append("<option value='"+plandeduction.deduction_info.voyageTemplateAry[i].id+"'>"+plandeduction.deduction_info.voyageTemplateAry[i].showtext+"</option>");plandeduction.setSjInputValueForInit(e,t);var l=$(window).height()-$("#deduction_set").height()-1;$("#deduction_set").css("top",l);var d=!1;""!=$("#deduction_ship_label").html()?($("#deduction_ship_select").hide(),$("#deduction_ship_label").show(),$("#deduction_ship_label_del").show(),d=!0):($("#deduction_ship_label").hide(),$("#deduction_ship_label_del").hide(),$("#deduction_ship_select").show()),plandeduction.selectVoygenEnableDis();var c=!1;plandeduction.deduction_info.typhoonAry.length>0&&""!=$("#deduction_typhoon_label").html()?($("#deduction_typhoon_select").hide(),$("#deduction_typhoon_label").show(),$("#deduction_typhoon_label_del").show(),c=!0):($("#deduction_typhoon_label").hide(),$("#deduction_typhoon_label_del").hide(),$("#deduction_typhoon_select").show());var r=$("#deduction_sj_input").val();(d||c)&&null!=r&&""!=r?$("#deduction_set_startbtn").css("background-color","#3385ff"):$("#deduction_set_startbtn").css("background-color","#adc4e7"),plandeduction.deduction_info.isChangeSelectShip="1",plandeduction.deduction_info.isChangeSelectTyphoon="1",plandeduction.deduction_info.isChangeSelectVoygen="1"},setSjInputValueForInit:function(e,t){for(var o=!1,n=0,a=0;a<plandeduction.deduction_info.fleetShipAry.length;a++)if(plandeduction.deduction_info.fleetShipAry[a].mmsi==e){null!=plandeduction.deduction_info.fleetShipAry[a].departTime&&""!=plandeduction.deduction_info.fleetShipAry[a].departTime&&(o=!0,n=parseInt(plandeduction.deduction_info.fleetShipAry[a].departTime));break}for(var i=!1,l=0,a=0;a<plandeduction.deduction_info.typhoonAry.length;a++)if(plandeduction.deduction_info.typhoonAry[a].typhoon_name==t){i=!0,l=(typhoonname=plandeduction.deduction_info.typhoonAry[a].playpoints)[0].pos_time;break}d=(new Date).getTime()/1e3;if(o&&i){d=l;n<l&&(d=n)}else if(o)d=n;else if(i)var d=l;var c=new Date;c.setTime(1e3*d),$("#deduction_sj_input").val(plandeduction.formatDateFULL(c))},clickPlaySetArrowRight:function(){$("#deduction_set_td_left").is(":hidden")?($("#deduction_set_td_left").show(),$("#deduction_set").css("width",305),$("#img_deduction_set_arrow").attr("src","./images/arrow_left.png")):($("#deduction_set_td_left").hide(),$("#deduction_set").css("width",30),$("#img_deduction_set_arrow").attr("src","./images/arrow_right.png"))},clickDelShip:function(){$("#deduction_ship_label").hide(),$("#deduction_ship_label_del").hide(),$("#deduction_ship_select").show(),plandeduction.deduction_info.isChangeSelectShip="0",$("#deduction_ship_select").val(""),plandeduction.deduction_info.selectShipMmsi="",plandeduction.deduction_info.selectShipName="",plandeduction.deduction_info.isChangeSelectShip="1",plandeduction.setUiSetStartBtnState(),plandeduction.selectVoygenEnableDis()},clickDelTyphoon:function(){$("#deduction_typhoon_label").hide(),$("#deduction_typhoon_label_del").hide(),$("#deduction_typhoon_select").show(),plandeduction.deduction_info.isChangeSelectTyphoon="0",$("#deduction_typhoon_select").val(""),plandeduction.deduction_info.selectTyphoonStormId="",plandeduction.deduction_info.selectTyphoonName="",plandeduction.deduction_info.isChangeSelectTyphoon="1",plandeduction.setUiSetStartBtnState()},clickDelVoygen:function(){$("#deduction_voygen_label").hide(),$("#deduction_voygen_label_del").hide(),$("#deduction_voygen_select").show(),$("#deduction_voygen_add").show(),$("#deduction_voygen_select_td").show(),plandeduction.deduction_info.isChangeSelectVoygen="0",$("#deduction_voygen_select").val(""),plandeduction.deduction_info.selectVoyageTemplateId="",plandeduction.deduction_info.selectVoyageTemplateName="",plandeduction.deduction_info.isChangeSelectVoygen="1"},selectVoygenEnableDis:function(){""==plandeduction.deduction_info.selectShipMmsi?($("#deduction_voygen_label").hide(),$("#deduction_voygen_label_del").hide(),$("#deduction_voygen_select").show(),$("#deduction_voygen_add").show(),$("#deduction_voygen_select_td").show(),plandeduction.deduction_info.isChangeSelectVoygen="0",$("#deduction_voygen_select").val(""),plandeduction.deduction_info.selectVoyageTemplateId="",plandeduction.deduction_info.selectVoyageTemplateName="",plandeduction.deduction_info.isChangeSelectVoygen="1",$("#deduction_voygen_select").attr("disabled","disabled"),$("#deduction_voygen_select").css("background-color","#e4e7e8"),$("#deduction_voygen_add").css("color","#e4e7e8")):($("#deduction_voygen_select").removeAttr("disabled"),$("#deduction_voygen_select").css("background-color","#ffffff"),$("#deduction_voygen_add").css("color","#508bbe"))},selectShipChange:function(){void 0!==plandeduction.deduction_info.isChangeSelectShip&&"0"!=typeof plandeduction.deduction_info.isChangeSelectShip&&(plandeduction.deduction_info.selectShipMmsi=$("#deduction_ship_select").val(),plandeduction.deduction_info.selectShipName=$("#deduction_ship_select").find("option:selected").text(),""==plandeduction.deduction_info.selectShipMmsi?plandeduction.deduction_info.selectShipName="":($("#deduction_ship_label").html(plandeduction.deduction_info.selectShipName),$("#deduction_ship_select").hide(),$("#deduction_ship_label").show(),$("#deduction_ship_label_del").show()),plandeduction.setUiSetStartBtnState(),plandeduction.selectVoygenEnableDis())},selectTyphoonChange:function(){void 0!==plandeduction.deduction_info.isChangeSelectTyphoon&&"0"!=typeof plandeduction.deduction_info.isChangeSelectTyphoon&&(plandeduction.deduction_info.selectTyphoonStormId=$("#deduction_typhoon_select").val(),plandeduction.deduction_info.selectTyphoonName=$("#deduction_typhoon_select").find("option:selected").text(),""==plandeduction.deduction_info.selectTyphoonStormId?plandeduction.deduction_info.selectTyphoonName="":($("#deduction_typhoon_label").html(plandeduction.deduction_info.selectTyphoonName),$("#deduction_typhoon_select").hide(),$("#deduction_typhoon_label").show(),$("#deduction_typhoon_label_del").show()),plandeduction.setUiSetStartBtnState())},selectVoygenChange:function(){void 0!==plandeduction.deduction_info.isChangeSelectVoygen&&"0"!=typeof plandeduction.deduction_info.isChangeSelectVoygen&&(plandeduction.deduction_info.selectVoyageTemplateId=$("#deduction_voygen_select").val(),plandeduction.deduction_info.selectVoyageTemplateName=$("#deduction_voygen_select").find("option:selected").text(),""==plandeduction.deduction_info.selectVoyageTemplateId?plandeduction.deduction_info.selectVoyageTemplateName="":($("#deduction_voygen_label").html(plandeduction.deduction_info.selectVoyageTemplateName),$("#deduction_voygen_select").hide(),$("#deduction_voygen_add").hide(),$("#deduction_voygen_select_td").hide(),$("#deduction_voygen_label").show(),$("#deduction_voygen_label_del").show()))},setUiSetStartBtnState:function(){var e=!1;""!=plandeduction.deduction_info.selectShipMmsi&&(e=!0);var t=!1;""!=plandeduction.deduction_info.selectTyphoonStormId&&(t=!0);var o=$("#deduction_sj_input").val();(e||t)&&null!=o&&""!=o?$("#deduction_set_startbtn").css("background-color","#3385ff"):$("#deduction_set_startbtn").css("background-color","#adc4e7"),plandeduction.setSjInputValueForInit(plandeduction.deduction_info.selectShipMmsi,plandeduction.deduction_info.selectTyphoonName)},voyagenTemplateAdd:function(){"rgb(228, 231, 232)"!=$("#deduction_voygen_add").css("color")&&(voyage_plan_add_open_source_deduction="1",voyage_plan_add.open_addwindow())},voyagenTemplateAddFinish:function(e){plandeduction.getVoyageTemplate(),$("#deduction_voygen_select").empty(),$("#deduction_voygen_select").append("<option value=''>"+Lg.getContent("all_select")+"</option>");for(var t=0;t<plandeduction.deduction_info.voyageTemplateAry.length;t++)$("#deduction_voygen_select").append("<option value='"+plandeduction.deduction_info.voyageTemplateAry[t].id+"'>"+plandeduction.deduction_info.voyageTemplateAry[t].showtext+"</option>");$("#deduction_voygen_select").val(e),plandeduction.selectVoygenChange()},deduction_window_close:function(){plandeduction.initStoreInfo(),$("#deduction_set").hide()},deductionInit:function(e,t){plandeduction.initStoreInfo(),plandeduction.deduction_info.selectShipMmsi=e,plandeduction.deduction_info.selectTyphoonName=t,plandeduction.getFleetInfo(),plandeduction.getTyphoon(),plandeduction.getVoyageTemplate(),playback_ext.setMap(LS.mymap),playback_ext.setSliderValueFunName("plandeduction.playcontrol_setSliderValue"),playback_ext.setCurSjLabelFunName("plandeduction.playcontrol_showTime"),playback_ext.setPlayToEndFun("plandeduction.playcontrol_end"),playback_ext.setIsExcTrackCall(!1);for(var o="",n=0;n<plandeduction.deduction_info.fleetShipAry.length;n++)""==(o=plandeduction.deduction_info.fleetShipAry[n].shipname)&&(o=plandeduction.deduction_info.fleetShipAry[n].shipename),""!=o&&plandeduction.deduction_info.fleetShipAry[n].mmsi==e&&(plandeduction.deduction_info.selectShipName=o)},show_playcontrolUi:function(e,t,o){plandeduction.deductionInit("",""),plandeduction.deduction_info.isChangeSpeed=!0;var n=$("#deduction_player_speed").val();$("#ship_list_content").hide();var a=L.Config._SERVICE_URL+"/deduction/selectPlanVoyageSpeed",i=$.cookie("__key");if($.ajax({url:a,data:{voyageshipid:o,cookievalue:i},type:"POST",dataType:"json",async:!1,success:function(e){if(0==e.status&&null!=e.data){var t=e.data;n=t.speed,$("#deduction_player_speed").val(n)}}}),parseFloat(n)<=0&&(plandeduction.deduction_info.isChangeSpeed=!1,$("#deduction_player_speed").val(10),plandeduction.deduction_info.isChangeSpeed=!0),$("#playsum_img").hide(),$("#deduction_set").hide(),plandeduction.deduction_info.shipTrackAll=[],null!=e&&""!=e&&null!=t&&""!=t){var l=plandeduction.getTimeFromformatFull(t);plandeduction.getShipTrackInfo(e,l,o,"plandeduction.show_playcontrolUi_Ext")}else plandeduction.show_playcontrolUi_Ext();L.CNZZ.playTyphoonStart()},show_playcontrolUi_Ext:function(){deduction_mapstate=LS.maptype,plandeduction.closeAllFleetShipIcon(),play_more_isShowPlayback=!0,plandeduction.deduction_info.isChangeCurSjLabelAndSliderValue="1";t=parseFloat($("#deduction_player_speed").val());if(plandeduction.HcshipTrack(t),plandeduction.playcontrol_datainit(!1),null!=play_more_InterfacePosList&&play_more_InterfacePosList.length>0){var e=playBackControl.getStartTime();plandeduction.setSliderInfo(e);var t=parseFloat($("#deduction_player_speed").val());plandeduction.deduction_info.isChangeTrackCheck=!1,plandeduction.playcontrol_clearMapObj(),plandeduction.playcontrol_createMapObj(),plandeduction.playcontrol_showMapObj(),plandeduction.deduction_info.isChangeTrackCheck=!0,$("#img_deduction_playcontrol_start").attr("src","images/pause.png"),setTimeout(playback_ext.play(),700),plandeduction.zoomMapToBand()}else alert("选择的时间范围没有轨迹数据！"),plandeduction.close_playcontrolUiClick()},zoomMapToBand:function(){for(var e=0,t=0,o=0,n=0,a=!1,i=plandeduction.getSelectTyphoonList(),l=0;l<i.length;l++)for(var d=i[l].playpoints,c=0;c<d.length;c++){var r=d[c].lon/6e5,p=d[c].lat/6e5;a?(r<e?e=r:r>t&&(t=r),p<o?o=p:p>n&&(n=p)):(e=r,t=r,o=p,n=p),a=!0}if(plandeduction.deduction_info.shipTrackAll.length>0)for(l=0;l<plandeduction.deduction_info.shipTrackAll.length;l++)for(var d=plandeduction.deduction_info.shipTrackAll[l].hctrickpoint,c=0;c<d.length;c++){var r=d[c].lon/6e5,p=d[c].lat/6e5;a?(r<e?e=r:r>t&&(t=r),p<o?o=p:p>n&&(n=p)):(e=r,t=r,o=p,n=p),a=!0}if(a){var s=L.latLng(o,e),u=L.latLng(n,t),_=L.latLngBounds(s,u);LS.mymap.fitBounds(_)}},playcontrol_clearMapObjStore:function(){plandeduction.deduction_info.shipTrackMapObjLine=[],plandeduction.deduction_info.shipTrackMapObjPoint=[]},playcontrol_createMapObj:function(){if(plandeduction.playcontrol_clearMapObjStore(),null!=plandeduction.deduction_info.shipTrackAll&&0!=plandeduction.deduction_info.shipTrackAll.length)for(var e=playback_ext.getTracks(),t=0;t<plandeduction.deduction_info.shipTrackAll.length;t++){var o,n,a,i=e[t],l=plandeduction.deduction_info.shipTrackAll[t].hctrickpoint,d=plandeduction.deduction_info.shipTrackAll[t].curvoyagepoint.length,c=plandeduction.deduction_info.shipTrackAll[t].voygentempid,r={stroke:!1,color:"#1b8ff2",fillColor:"#1b8ff2",fillOpacity:1,radius:3};if(null!=plandeduction.deduction_info.shipTrackAll[t].curvoyagepoint&&plandeduction.deduction_info.shipTrackAll[t].curvoyagepoint.length>0){var d=plandeduction.deduction_info.shipTrackAll[t].curvoyagepoint.length,p=plandeduction.deduction_info.shipTrackAll[t].planvoygentemppoint,s=0,u=[];if(null!=c&&""!=c)for(k=0;k<p.length;k++)for(var _=1e3*p[k].pos_time,h=s;h<i.length;h++)if((b=i[h].time)>=_){(s=h)>=1&&u.push(i[s]);break}u=conllisionUtil.pointDataSparing(u,"lng","lat",1);for(k=0;k<u.length;k++){var y=u[k].lng,f=u[k].lat;plandeduction.createMapObjPoint(y,f,r)}for(var g=[],m=plandeduction.deduction_info.shipTrackAll[t].curvoyagepoint,k=0;k<d;k++){0==k&&(o=m[k].lat/6e5,n=m[k].lon/6e5);var y=m[k].lon/6e5,f=m[k].lat/6e5,v=plandeduction.getMapObjLinePoint(y,f);g.push(v[0])}T={weight:3,color:"#1b8ff2"};plandeduction.createMapObjLine(g,T),g=[];for(k=0;k<i.length;k++){k==i.length-1&&(a=i[k].lat,endLon=i[k].lng);var y=i[k].lng,f=i[k].lat,v=plandeduction.getMapObjLinePoint(y,f);g.push(v[0])}T={weight:3,color:"#1b8ff2",dashArray:"10,5"};plandeduction.createMapObjLine(g,T);S=plandeduction.drawStartEndMark(o,n,a,endLon);plandeduction.deduction_info.startEndPoint=S}else{if(null!=c&&""!=c)for(var s=0,k=0;k<l.length;k++){for(var _=1e3*l[k].pos_time,h=s;h<i.length;h++){var b=i[h].time;if(b>=_){s=h;break}}if(s>=0){var y=i[s].lng,f=i[s].lat;plandeduction.createMapObjPoint(y,f,r)}}for(var g=[],k=0;k<i.length;k++){0==k&&(o=i[k].lat,n=i[k].lng),k==i.length-1&&(a=i[k].lat,endLon=i[k].lng);var y=i[k].lng,f=i[k].lat,v=plandeduction.getMapObjLinePoint(y,f);g.push(v[0])}var T={weight:2,color:"#1b8ff2"};plandeduction.createMapObjLine(g,T);var S=plandeduction.drawStartEndMark(o,n,a,endLon);plandeduction.deduction_info.startEndPoint=S}}},getMapObjLinePoint:function(e,t){var o=[];o.push(t),o.push(e);var n=[];return n.push(o),n},drawStartEndMark:function(e,t,o,n){try{var a=new L.layerGroup([]),i=LS.lnglatsTrans3(e,t),l=LS.lnglatsTrans3(o,n),d=L.marker(i,{icon:this.getMarkerIcon("planvostartpoint")}),c=L.marker(l,{icon:this.getMarkerIcon("planvostoppoint")});return a.addLayer(d),a.addLayer(c),a.addTo(LS.mymap),a}catch(e){console.log(e)}},getMarkerIcon:function(e){var t="images/"+e+".png";return L.icon({iconUrl:t,iconSize:[20,26],iconAnchor:[10,26]})},createMapObjLine:function(e,t){var o=new L.Polyline(e,t);plandeduction.deduction_info.shipTrackMapObjLine.push(o)},createMapObjPoint:function(e,t,o){var n=L.latLng(t,e),a=new L.circleMarker(n,o);plandeduction.deduction_info.shipTrackMapObjPoint.push(a)},gpsPyOne:function(e,t){var o=L.GPS.transform(e,t),n={};return n.lat=o[0],n.lon=o[1],n},playcontrol_clearMapObj:function(){var e=LS.mymap;if(plandeduction.deduction_info.shipTrackMapObjPoint.length>0)for(t=0;t<plandeduction.deduction_info.shipTrackMapObjPoint.length;t++)e.removeLayer(plandeduction.deduction_info.shipTrackMapObjPoint[t]);if(plandeduction.deduction_info.shipTrackMapObjLine.length>0)for(var t=0;t<plandeduction.deduction_info.shipTrackMapObjLine.length;t++)e.removeLayer(plandeduction.deduction_info.shipTrackMapObjLine[t]);plandeduction.deduction_info.startEndPoint&&e.removeLayer(plandeduction.deduction_info.startEndPoint)},playcontrol_showMapObj:function(){var e=LS.mymap;if(plandeduction.deduction_info.shipTrackMapObjLine.length>0)for(t=0;t<plandeduction.deduction_info.shipTrackMapObjLine.length;t++)e.addLayer(plandeduction.deduction_info.shipTrackMapObjLine[t]);if(plandeduction.deduction_info.shipTrackMapObjPoint.length>0)for(var t=0;t<plandeduction.deduction_info.shipTrackMapObjPoint.length;t++)e.addLayer(plandeduction.deduction_info.shipTrackMapObjPoint[t])},playcontrol_play_zt:function(){$("#img_deduction_playcontrol_start")[0].src.indexOf("images/play.png")>=0?(plandeduction.playcontrol_play(),$("#img_deduction_playcontrol_start").attr("title",Lg.getContent("play_pause")),$("#img_deduction_playcontrol_start").attr("alt",Lg.getContent("play_pause"))):(plandeduction.playcontrol_zt(),$("#img_deduction_playcontrol_start").attr("title",Lg.getContent("voyage_play")),$("#img_deduction_playcontrol_start").attr("alt",Lg.getContent("voyage_play")))},playcontrol_discontrol:function(){$("#deduction_playcontrol_speed").attr("readonly","readonly")},getSelectTyphoonList:function(){for(var e=[],t=plandeduction.deduction_info.selectTyphoonStormId,o=0;o<plandeduction.deduction_info.typhoonAry.length;o++)if(plandeduction.deduction_info.typhoonAry[o].stormId==t){var n=plandeduction.deduction_info.typhoonAry[o],a={};a.typhoon_name=n.typhoon_name,a.stormId=n.stormId,a.playpoints=plandeduction.getSelectTyphoonListForPoint(n.playpoints),a.playpoints_d=plandeduction.getSelectTyphoonListForPoint(n.playpoints_d),e.push(a)}return e},getSelectTyphoonListForPoint:function(e){for(var t=$("#deduction_sj_input").val(),o=plandeduction.getTimeFromformatFull(t),n=[],a=0;a<e.length;a++)e[a].pos_time>=o&&n.push(e[a]);return n},addAllPlayDataToPlayControl:function(){if(plandeduction.deduction_info.shipTrackAll.length>0)for(o=0;o<plandeduction.deduction_info.shipTrackAll.length;o++){var e=plandeduction.deduction_info.shipTrackAll[o];1!=LS.maptype?(e.planvoygentemppoint=[],e.planvoygentemppoint=plandeduction.gpsPy(e.planvoygentemppoint_d)):(e.planvoygentemppoint=[],e.planvoygentemppoint=e.planvoygentemppoint_d),playback_ext.add_trackByInterfacePosList(e.planvoygentemppoint,"ship")}for(var t=plandeduction.getSelectTyphoonList(),o=0;o<t.length;o++)1!=LS.maptype?t[o].playpoints=plandeduction.gpsPy(t[o].playpoints_d):t[o].playpoints=t[o].playpoints_d,null!=t[o].playpoints&&t[o].playpoints.length>0&&playback_ext.add_trackByInterfacePosList(t[o].playpoints,"typhoon")},playcontrol_datainit:function(e){if(playback_ext.clear_All(),plandeduction.addAllPlayDataToPlayControl(),null!=play_more_InterfacePosList&&play_more_InterfacePosList.length>0){if(playback_ext.initPlayBackExt(),e){playback_ext.setDefaultPlayBl();var t=playback_ext.calculaSpeed();playBackControl.setSpeed(t),play_more_Track_play_zoom=playback_ext.calculaPlayTrickZoom(),playBackControl.setPlayTrickZoom(play_more_Track_play_zoom)}var o=playBackControl.getStartTime(),n=playBackControl.getEndTime(),a=playBackControl.getTime(),i=new Date(o);$("#deduction_playcontrol_minsj").val(plandeduction.formatDateForLabel2(i));var l=new Date(n);$("#deduction_playcontrol_maxsj").val(plandeduction.formatDateForLabel2(l));var d=new Date(a);$("#deduction_playcontrol_cursj").val(plandeduction.formatDateForLabel2(d)),$("#deduction_playcontrol_curtime").html(plandeduction.formatDateForLabel2(d))}},mapObjInit:function(){plandeduction.playcontrol_clearMapObj(),plandeduction.playcontrol_createMapObj(),document.getElementById("deduction_playcontrol_checkbox").checked&&plandeduction.playcontrol_showMapObj()},setSliderInfo:function(e){var t=playBackControl.getStartTime(),o=playBackControl.getEndTime(),n=playBackControl.getTickLen();$("#deduction_playback_playcontrol_slider").slider({min:t,max:o,step:n,value:e,range:"min",slide:function(e,t){playback.setCursor(t.value),plandeduction.playcontrol_showTime(t.value)}}),$("#deduction_playback_playcontrol_slider").slider("value",e)},playcontrol_play:function(){var e=$("#deduction_playcontrol_speed").val();parseFloat(e)<=0?alert("航速必须大于0！"):(plandeduction.playcontrol_discontrol(),$("#img_deduction_playcontrol_start").attr("src","images/pause.png"),playBackControl.getTime()<playBackControl.getEndTime()?playback_ext.play():playback_ext.gotoFirstAndPlay())},playcontrol_end:function(){$("#img_deduction_playcontrol_startzt").attr("src","images/play_control_play.png"),$("#img_deduction_playcontrol_start").attr("src","images/play.png")},playcontrol_zt:function(){playback_ext.stop(),$("#img_deduction_playcontrol_start").attr("src","images/play.png")},playcontrol_kb:function(){playback_ext.FastForward(),$("#deduction_playcontrol_curSlBs").html(play_more_speed_bs)},playcontrol_speedRate:function(e){playback_ext.PowerRateForward(e)},playcontrol_mb:function(){if(1==play_more_speed_bs){var e=playBackControl.getStartTime(),t=0,o=((playBackControl.getEndTime()-e)/864e5).toString();if(o.indexOf(".")>=0){var n=o.indexOf(".");o=o.substring(0,n),t=parseInt(o)+1}else t=parseInt(o);if(t>3)return}playback_ext.SlowForward(),$("#deduction_playcontrol_curSlBs").html(play_more_speed_bs)},playcontrol_showTime:function(e){var t=new Date(e),o=plandeduction.formatDateForLabel1(t);$("#deduction_playcontrol_cursj").val(o),$("#deduction_playcontrol_curtime").html(o)},playcontrol_setSliderValue:function(e){void 0!==plandeduction.deduction_info.isChangeCurSjLabelAndSliderValue&&"0"!=plandeduction.deduction_info.isChangeCurSjLabelAndSliderValue&&$("#deduction_playback_playcontrol_slider").slider("value",e)},playcontrol_shiptrickCheckClick:function(){plandeduction.deduction_info.isChangeTrackCheck&&(document.getElementById("deduction_playcontrol_checkbox").checked?plandeduction.playcontrol_showMapObj():plandeduction.playcontrol_clearMapObj())},speedchange:function(){if(plandeduction.deduction_info.isChangeSpeed){var e=$("#deduction_playcontrol_speed").val();if(parseFloat(e)<=0)return void alert("航速必须大于0！");var t=parseFloat($("#deduction_playcontrol_speed").val());t>50&&($("#deduction_playcontrol_speed").val(50),t=parseFloat($("#deduction_playcontrol_speed").val())),plandeduction.HcshipTrack(t),plandeduction.playcontrol_datainit(!1),plandeduction.mapObjInit();var o=playBackControl.getStartTime();plandeduction.setSliderInfo(o)}},mapchange:function(){1==deduction_mapstate?1!=LS.maptype&&null!=playBackControl&&setTimeout(plandeduction.mapchangeExc,50):1==LS.maptype&&null!=playBackControl&&setTimeout(plandeduction.mapchangeExc,50),deduction_mapstate=LS.maptype},mapchangeExc:function(){var e=play_more_playstate;"play"==e&&playback_ext.stop(),plandeduction.deduction_info.isChangeCurSjLabelAndSliderValue="0";var t=playBackControl.getTime();plandeduction.playcontrol_datainit(!1),plandeduction.playcontrol_clearMapObj(),plandeduction.playcontrol_createMapObj(),document.getElementById("deduction_playcontrol_checkbox").checked&&plandeduction.playcontrol_showMapObj(),plandeduction.setSliderInfo(t),playback_ext.setCursor(t),"play"==e&&playback_ext.play(),plandeduction.deduction_info.isChangeCurSjLabelAndSliderValue="1"},windowReSize:function(){e=$(window).height()-$("#deduction_set").height()-1;$("#deduction_set").css("top",e);var e=$(window).height()-$("#deduction_playcontrol").height()-1;$("#deduction_playcontrol").css("top",e);var t=$(window).width();t<500&&(t=500),$("#deduction_playcontrol").css("width",t);var o=$(window).width()-20;$("#deduction_playcontrol_td_left").css("width",o)},speedinput:function(){var e=parseFloat($("#deduction_playcontrol_speed").val());e>50&&$("#deduction_playcontrol_speed").val(50),e<1&&$("#deduction_playcontrol_speed").val(1)},close_playcontrolUiClick:function(){if($("#plandeductionplayer")){$("#playsum_img").show(),$("#ship_list_content").show();var e=$("#plandeduction_mmsi").val();"1"==playback_ext.stop()?(setTimeout(plandeduction.close_playcontrolUi,500),$("span[ship_mmsi='"+e+"'][class='myship_list_span']").click()):(plandeduction.close_playcontrolUi(),$("span[ship_mmsi='"+e+"'][class='myship_list_span']").click()),$("#plandeductionplayer").remove()}},close_playcontrolUi:function(){$("#plandeductionplayer").remove(),playback_ext.clear_All(),shipeventmoudle.showAndRemoveAllCom(!0),plandeduction.playcontrol_clearMapObj(),play_more_isShowPlayback=!1,plandeduction.showAllFleetShipIcon(),tyhoon_Object.showAndHideCom(!0)}},viewplandeduction={initPlandeductionPlayer:function(e,t,o){$("#plandeductionplayer")&&$("#plandeductionplayer").remove();var n="<div class='movewindowcom plandeductionwindow' id='plandeductionplayer'><div class='plandeductionhead'><span  onclick='plandeduction.close_playcontrolUiClick()' class='plandeductionclose'><img src='./images/shipseimgclose.png'/></span></div><div class='plandeductionmiddiv'><div class='plandeductionmiddiv-s'><div id='deduction_playcontrol_curtime' readonly='readonly' class='plandeductiontime'>00/00 00:00</div><input type='hidden' id='deduction_player_speed' value='10'/><input type='hidden' id='plandeduction_mmsi' value='"+e+"'/><div class='plandeduction-progress'><div id='deduction_playback_playcontrol_slider' style='height:9px;width:120px;background:#e3e6eb;border:1px solid #ffffff;border-radius:0px;-webkit-border-radius:0px;-moz-border-radius :0px;'></div></div><div class='plandeductionplay'><img id='img_deduction_playcontrol_start' src='./images/pause.png' onclick='plandeduction.playcontrol_play_zt()'/></div><div class='plandeductionstop'><img src='./images/stop.png' onclick='plandeduction.close_playcontrolUiClick()'/></div></div><div class='plandeductionspeed'>"+Lg.getContent("fore_speed")+"&nbsp;&nbsp;<select id='deduction_play_speed_select'><option value='1' selected='selected'>"+Lg.getContetnFormat("fore_times",1)+"</option><option value='2'>"+Lg.getContetnFormat("fore_times",2)+"</option><option value='3'>"+Lg.getContetnFormat("fore_times",3)+"</option><option value='4'>"+Lg.getContetnFormat("fore_times",4)+"</option><option value='5'>"+Lg.getContetnFormat("fore_times",5)+"</option><option value='6'>"+Lg.getContetnFormat("fore_times",6)+"</option><option value='7'>"+Lg.getContetnFormat("fore_times",7)+"</option><option value='8'>"+Lg.getContetnFormat("fore_times",8)+"</option><option value='9'>"+Lg.getContetnFormat("fore_times",9)+"</option><option value='10'>"+Lg.getContetnFormat("fore_times",10)+"</option></select></div></div></div>";$("body").append(n),$("#plandeductionplayer").movew({moveClass:"plandeductionhead"}),$("#plandeductionplayer").show("slow"),$("#deduction_play_speed_select").change(function(){plandeduction.playcontrol_speedRate($("#deduction_play_speed_select").val())}),this.initImg(),plandeduction.show_playcontrolUi(e,t,o)},initImg:function(){(new Image).src="./images/unshipfleetdrive.png"}},voyageplanview={loadViewPopup:function(){var e=$.cookie("__key");e?$.getJSON(L.Config._SERVICE_URL+"/voyage/getPlanVoyageShip",{cookievalue:e},function(e){try{if("0"==e.status){var t=e.data;if(t){var o="<div class='movewindowcom voyageplanwindow' id='voyageplanpopup'><div class='voyageplanhead'><span  onclick='voyageplanview.voyageplanpopupclose()'><img src='./images/shipseimgclose.png'></span></div><div class='voyageplanmiddiv'><div class='voyageplanmiddiv-s' id='voyageplanpopupbody' value='"+t.templateId+"'>【"+(t.shipname.length>10?t.shipname.substring(0,10)+"...":t.shipname)+"】 有新的计划航线了 <span id='voyageplanspan' value='"+t.shipid+"' onclick='voyageplanview.viewvoyageplan()'>立即查看</span></div></div></div>";$("body").append(o),$("#voyageplanpopup").show("slow")}}}catch(e){console.log(e)}}):userTipUtil.infoTips("user_sig")},voyageplanpopupclose:function(){$("#voyageplanpopup").hide("slow"),this.updateplanreadstate()},viewvoyageplan:function(){this.voyageplanpopupclose();var e=$("#voyageplanspan").attr("value");voyageplanline.openByLookTips(e,"")},updateplanreadstate:function(){var e=$.cookie("__key");e?$.post(L.Config._SERVICE_URL+"/voyage/updatePlanVoyageShipReadStatus",{cookievalue:e},function(e){}):userTipUtil.infoTips("user_sig")}};